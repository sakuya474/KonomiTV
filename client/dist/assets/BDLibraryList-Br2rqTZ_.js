import{d as F,am as Q,Z as k,x as X,c as d,F as C,w as _,a,k as H,r as W,h as o,b as i,e as c,ai as N,U,t as V,f as Y,p as g,n as L,R as x,j as tt,l as w,ab as et,V as A,ap as O,M as p,o as l,_ as P,B as $,g as it}from"./index-26jul5yA.js";import{B as at}from"./BDLibrary-Bb45fGJY.js";import{u as st}from"./BDLibraryHistoryStore-wFv8Ll5B.js";import{u as lt}from"./BDLibraryMylistStore-DF-7NiOs.js";import{b as ot,V as T,a as z,d as rt,c as nt}from"./VSelect-r-so1AtO.js";import{V as dt}from"./VDivider-DDyHcbCK.js";import{d as ut,V as mt,b as yt,c as ct}from"./VCard-Cvs9lGZ1.js";import{V as bt}from"./VSpacer-D77fs5_2.js";import{V as ft}from"./VDialog-xXriaxfi.js";import{V as vt}from"./VPagination-B_Tp0z52.js";const pt={class:"bd-library-item__container"},gt={class:"bd-library-item__thumbnail"},ht=["src"],wt={key:0,class:"bd-library-item__thumbnail-duration"},Bt={key:1,class:"bd-library-item__thumbnail-progress"},Mt={class:"bd-library-item__content"},_t={class:"bd-library-item__content-title"},xt={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},kt={key:1,width:"22px",height:"22px",viewBox:"0 0 15.2 15.2"},Vt={class:"bd-library-item__menu"},Dt={class:"delete-confirmation__file-path mb-4"},St=F({__name:"BDLibraryItem",props:{item:{},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["deleted"],setup(e,{emit:b}){const r=e,h=b,B=O(),f=st(),M=lt(),n=Q(),s=k(!1),v=X(()=>M.mylist_items.some(u=>u.bd_id===r.item.bd_id||Number(u.id)===r.item.bd_id)),m=u=>{const t=Math.floor(u/3600),y=Math.floor(u%3600/60),D=Math.floor(u%60);return t>0?`${t}:${y.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`:`${y}:${D.toString().padStart(2,"0")}`},R=u=>{const t=u.target;t.src="/assets/images/icon.svg"},j=async()=>{await n.fetchUser(!0);const u=U.getAccessToken();if(!(n.is_logged_in&&u!==null)){p.error("マイリストを利用するにはログインが必要です。");return}if(v.value)await E();else try{await M.addToMylist({id:r.item.bd_id,title:r.item.title,path:""}),p.success("マイリストに追加しました。")}catch{p.error("マイリストの追加に失敗しました。")}},E=async()=>{const u=M.mylist_items.find(y=>y.id===r.item.id||y.bd_id===r.item.bd_id),t=u?u.id:r.item.id;try{await M.removeFromMylist(t),p.show("マイリストから削除しました。")}catch{p.error("マイリストの削除に失敗しました。");return}r.forMylist===!0&&h("deleted",r.item.id)},Z=async()=>{await f.removeHistory(r.item.id),p.show("視聴履歴から削除しました。"),r.forWatchedHistory===!0&&h("deleted",r.item.id)},q=()=>{B.push(`/bd-library/watch/${r.item.bd_id.toString()}`)},G=()=>{p.info("BD情報表示機能は未実装です。")},J=()=>{if(n.user===null||n.user.is_admin===!1){p.error(`BDを削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}s.value=!0},K=async()=>{s.value=!1,await at.deleteBD(r.item.bd_id)===!0&&(p.success("BDを削除しました。"),h("deleted",r.item.id))};return(u,t)=>{const y=W("Icon"),D=W("router-link"),I=tt("ftooltip");return l(),d(C,null,[_((l(),H(D,{class:"bd-library-item",to:`/bd-library/watch/${e.item.bd_id.toString()}`},{default:o(()=>[i("div",pt,[i("div",gt,[i("img",{class:"bd-library-item__thumbnail-image",loading:"lazy",decoding:"async",src:`${N(U).api_base_url}/bd-library/${e.item.bd_id.toString()}/thumbnail`,onError:R},null,40,ht),e.item.duration?(l(),d("div",wt,V(m(e.item.duration)),1)):c("",!0),e.item.position&&e.item.duration?(l(),d("div",Bt,[i("div",{class:"bd-library-item__thumbnail-progress-bar",style:Y(`width: ${e.item.position/e.item.duration*100}%`)},null,4)])):c("",!0)]),i("div",Mt,[i("div",_t,V(e.item.title),1)]),!e.forMylist&&!e.forWatchedHistory?_((l(),d("div",{key:0,class:L(["bd-library-item__mylist",{"bd-library-item__mylist--added":v.value}]),onClick:g(j,["prevent","stop"]),onMousedown:t[0]||(t[0]=g(()=>{},["prevent","stop"]))},[v.value?(l(),d("svg",xt,[...t[7]||(t[7]=[i("path",{fill:"#e91e63",d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032"},null,-1)])])):(l(),d("svg",kt,[...t[8]||(t[8]=[i("path",{fill:"#fff",d:"M8 2.5a.5.5 0 0 0-1 0V7H2.5a.5.5 0 0 0 0 1H7v4.5a.5.5 0 0 0 1 0V8h4.5a.5.5 0 0 0 0-1H8z"},null,-1)])]))],34)),[[x],[I,v.value?"マイリストから削除する":"マイリストに追加する"]]):c("",!0),e.forMylist?_((l(),d("div",{key:1,class:"bd-library-item__mylist",onClick:g(E,["prevent","stop"]),onMousedown:t[1]||(t[1]=g(()=>{},["prevent","stop"]))},[...t[9]||(t[9]=[i("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[i("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)])],32)),[[x],[I,"マイリストから削除する"]]):c("",!0),e.forWatchedHistory?_((l(),d("div",{key:2,class:"bd-library-item__mylist",onClick:g(Z,["prevent","stop"]),onMousedown:t[2]||(t[2]=g(()=>{},["prevent","stop"]))},[...t[10]||(t[10]=[i("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[i("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)])],32)),[[x],[I,"視聴履歴から削除する"]]):c("",!0),i("div",Vt,[a(rt,{location:"bottom end","close-on-content-click":!0},{activator:o(({props:S})=>[_((l(),d("div",et({class:"bd-library-item__menu-button"},S,{onClick:t[3]||(t[3]=g(()=>{},["prevent","stop"])),onMousedown:t[4]||(t[4]=g(()=>{},["prevent","stop"]))}),[...t[11]||(t[11]=[i("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[i("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)])],16)),[[x]])]),default:o(()=>[a(ot,{density:"compact","bg-color":"background-lighten-1",class:"bd-library-item__menu-list"},{default:o(()=>[a(T,{onClick:q},{prepend:o(()=>[a(y,{icon:"fluent:play-24-regular",width:"20px",height:"20px"})]),default:o(()=>[a(z,{class:"ml-3"},{default:o(()=>[...t[12]||(t[12]=[w("BDを再生",-1)])]),_:1})]),_:1}),a(T,{onClick:G},{prepend:o(()=>[...t[13]||(t[13]=[i("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[i("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])]),default:o(()=>[a(z,{class:"ml-3"},{default:o(()=>[...t[14]||(t[14]=[w("BD情報を表示",-1)])]),_:1})]),_:1}),a(dt),a(T,{onClick:J,class:"bd-library-item__menu-list-item--danger"},{prepend:o(()=>[a(y,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:o(()=>[a(z,{class:"ml-3"},{default:o(()=>[...t[15]||(t[15]=[w("BDを削除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1},8,["to"])),[[x]]),a(ft,{"max-width":"750",modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=S=>s.value=S)},{default:o(()=>[a(ut,null,{default:o(()=>[a(mt,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:o(()=>[...t[16]||(t[16]=[w("本当にBDを削除しますか？",-1)])]),_:1}),a(yt,{class:"pt-2 pb-0"},{default:o(()=>[i("div",Dt,V(e.item.path),1),t[17]||(t[17]=i("div",{class:"text-error-lighten-1 font-weight-bold"},[w(" このBDに関連するすべてのデータ (マイリスト / 視聴履歴を含む) が削除されます。"),i("br"),w(" 元に戻すことはできません。本当にBDを削除しますか？ ")],-1))]),_:1}),a(ct,{class:"pt-4 px-6 pb-6"},{default:o(()=>[a(bt),a(A,{color:"text",variant:"text",onClick:t[5]||(t[5]=S=>s.value=!1)},{default:o(()=>[a(y,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),t[18]||(t[18]=i("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),a(A,{class:"px-3",color:"error",variant:"flat",onClick:K},{default:o(()=>[a(y,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),t[19]||(t[19]=i("span",{class:"ml-1"},"BDを削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),$t=P(St,[["__scopeId","data-v-278e17dc"]]),Ct={key:0,class:"bd-library-list__header"},Ht={class:"bd-library-list__title"},Lt={class:"bd-library-list__title-text"},It={key:1,class:"bd-library-list__title-count"},Tt={class:"bd-library-list__actions"},zt={class:"bd-library-list__empty-content"},Wt=["innerHTML"],Ut=["innerHTML"],At={class:"bd-library-list__grid-content"},Et={key:1,class:"bd-library-list__pagination"},Ft=F({__name:"BDLibraryList",props:{title:{},items:{},total:{},page:{default:1},sortOrder:{default:"added_desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"BDが見つかりませんでした。"},emptySubMessage:{default:"BDライブラリにBDが追加されているか確認してください。"},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more"],setup(e){O();const b=e,r=k(b.page),h=k(b.sortOrder),B=k([...b.items]),f=k(b.total);$(()=>b.page,n=>{r.value=n}),$(()=>b.sortOrder,n=>{h.value=n}),$(()=>b.items,n=>{B.value=[...n]}),$(()=>b.total,n=>{f.value=n});const M=n=>{B.value=B.value.filter(s=>s.id!==n),f.value--};return(n,s)=>{const v=W("Icon");return l(),d("div",{class:L(["bd-library-list",{"bd-library-list--show-sort":!e.hideSort}])},[e.hideHeader?c("",!0):(l(),d("div",Ct,[i("h2",Ht,[e.showBackButton?_((l(),d("div",{key:0,class:"bd-library-list__title-back",onClick:s[0]||(s[0]=m=>n.$router.back())},[a(v,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[x]]):c("",!0),i("span",Lt,V(e.title),1),e.showMoreButton?c("",!0):(l(),d("div",It,[e.isSearching?(l(),d(C,{key:0},[a(v,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),s[6]||(s[6]=i("span",null,"検索中...",-1))],64)):(l(),d(C,{key:1},[w(V(f.value)+"件",1)],64))]))]),i("div",Tt,[e.hideSort?c("",!0):(l(),H(nt,{key:0,modelValue:h.value,"onUpdate:modelValue":[s[1]||(s[1]=m=>h.value=m),s[2]||(s[2]=m=>n.$emit("update:sortOrder",m))],items:[{title:"追加が新しい順",value:"added_desc"},{title:"追加が古い順",value:"added_asc"}],"item-title":"title","item-value":"value",class:"bd-library-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),e.showMoreButton?(l(),H(A,{key:1,variant:"text",class:"bd-library-list__more",onClick:s[3]||(s[3]=m=>n.$emit("more"))},{default:o(()=>[s[7]||(s[7]=i("span",{class:"text-primary"},"もっと見る",-1)),a(v,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):c("",!0)])])),i("div",{class:L(["bd-library-list__grid",{"bd-library-list__grid--loading":e.isLoading||e.isSearching,"bd-library-list__grid--empty":f.value===0&&e.showEmptyMessage,"bd-library-list__grid--searching":e.isSearching}])},[i("div",{class:L(["bd-library-list__empty",{"bd-library-list__empty--show":f.value===0&&e.showEmptyMessage&&!e.isSearching}])},[i("div",zt,[a(v,{class:"bd-library-list__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),i("h2",{innerHTML:e.emptyMessage},null,8,Wt),e.emptySubMessage?(l(),d("div",{key:0,class:"bd-library-list__empty-submessage",innerHTML:e.emptySubMessage},null,8,Ut)):c("",!0)])],2),i("div",At,[(l(!0),d(C,null,it(B.value,m=>(l(),H($t,{key:m.id,item:m,forMylist:e.forMylist,forWatchedHistory:e.forWatchedHistory,onDeleted:M},null,8,["item","forMylist","forWatchedHistory"]))),128))])],2),!e.hidePagination&&f.value>0?(l(),d("div",Et,[a(vt,{modelValue:r.value,"onUpdate:modelValue":[s[4]||(s[4]=m=>r.value=m),s[5]||(s[5]=m=>n.$emit("update:page",m))],"active-color":"primary",density:"comfortable",length:Math.ceil(f.value/31),"total-visible":N(U).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):c("",!0)],2)}}}),Qt=P(Ft,[["__scopeId","data-v-1ae80959"]]);export{Qt as B};
