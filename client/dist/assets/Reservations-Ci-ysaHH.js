import{d as A,X as r,z as y,y as N,aj as T,ae as k,c as x,a as l,b as g,ak as E,o as H,_ as U}from"./index-BjnRdZII.js";import{B as F}from"./Breadcrumbs-B_Cf5THq.js";import{H as O,N as V}from"./Navigation-XDSWwzZP.js";import{R as L}from"./ReservationList-9tP8c34x.js";import{S as P}from"./SPHeaderBar-CXNM1aey.js";import{R as $}from"./Reservations-CYmpV4oi.js";import"./VSpacer-CItjHwQn.js";import"./ssrBoot-D15FtRyu.js";import"./VSwitch-P0Gza8Yi.js";import"./index-D_0yGr-H.js";import"./VTextField-BQBpY8wy.js";import"./transition-DQr2RJV9.js";import"./forwardRefs-DboJVnh3.js";import"./VSelectionControl-Bdo-3yyP.js";import"./VChip-BaQkoIpP.js";import"./VAvatar-DUluRc1j.js";import"./VSlider-IOp7kDF3.js";import"./VCheckbox-DX8Dt6Sw.js";import"./VSelect-DImzQrok.js";import"./VMenu-VOv4bz30.js";import"./VDivider-Be-8Dkv7.js";import"./dialog-transition-Cx5vxeeX.js";import"./VDialog-J3PDj-NO.js";import"./VCard-D4SZOtDi.js";import"./VPagination-CuxK7yN3.js";const j={class:"route-container"},z={class:"reservations-all-container-wrapper"},C={class:"reservations-all-container"},M=30*1e3,X=A({__name:"Reservations",setup(G){const a=T(),_=E(),p=r([]),m=r(0),o=r(1),n=r("asc"),u=r(!0),s=r([]),R=r(),i=r(null);async function q(){const e=await $.fetchReservations();e&&(s.value=e.reservations)}function v(){if(s.value.length===0){p.value=[],m.value=0;return}let e=[...s.value];n.value==="asc"?e.sort((d,f)=>new Date(d.program.start_time).getTime()-new Date(f.program.start_time).getTime()):e.sort((d,f)=>new Date(f.program.start_time).getTime()-new Date(d.program.start_time).getTime());const t=25,h=(o.value-1)*t,I=h+t;p.value=e.slice(h,I),m.value=e.length}async function w(e){o.value=e,await _.replace({query:{...a.query,page:e.toString()}})}async function b(e){n.value=e,o.value=1,await _.replace({query:{...a.query,order:e,page:"1"}})}function D(e){s.value=s.value.filter(t=>t.id!==e),v(),console.log(`Reservation ${e} deleted, refreshing list...`),c()}const c=async()=>{try{await q(),u.value=!1}catch(e){console.error("Failed to update reservation list:",e),u.value=!1}},S=()=>{i.value===null&&(c(),i.value=window.setInterval(c,M))},B=()=>{i.value!==null&&(clearInterval(i.value),i.value=null)};return y(()=>a.query,async e=>{if(e.page){const t=parseInt(String(e.page),10);Number.isFinite(t)&&t>0&&(o.value=t)}if(e.order){const t=String(e.order);(t==="asc"||t==="desc")&&(n.value=t)}v()},{deep:!0}),y(()=>s.value,()=>{v()},{deep:!0}),N(async()=>{a.query.page&&typeof a.query.page=="string"&&(o.value=parseInt(a.query.page,10)),a.query.order&&typeof a.query.order=="string"&&(n.value=a.query.order),S()}),k(()=>{B()}),(e,t)=>(H(),x("div",j,[l(O),g("main",null,[l(V),g("div",z,[l(P),g("div",C,[l(F,{crumbs:[{name:"ホーム",path:"/"},{name:"録画予約",path:"/reservations/"},{name:"録画予約一覧",path:"/reservations/all",disabled:!0}]}),l(L,{ref_key:"reservation_list",ref:R,title:"録画予約一覧",reservations:p.value,total:m.value,page:o.value,"sort-order":n.value,"is-loading":u.value,"show-back-button":!0,"show-empty-message":!u.value,"onUpdate:page":w,"onUpdate:sortOrder":b,onRefresh:c,onDelete:D},null,8,["reservations","total","page","sort-order","is-loading","show-empty-message"])])])])]))}}),ye=U(X,[["__scopeId","data-v-08fc60c1"]]);export{ye as default};
