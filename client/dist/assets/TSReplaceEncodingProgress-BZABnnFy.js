import{d as Z,al as $,q as s,X as w,z as U,c as v,e as i,n as S,b as a,a as t,r as ee,t as d,am as W,k,V as _,p as C,h as l,w as se,v as ae,l as q,an as te,M as re,o,_ as oe}from"./index-l7mZcvr7.js";import{V as le}from"./index-CrDjSE9Q.js";import{V as X}from"./VChip-CSNb315t.js";import{V as ne}from"./RecordedProgramList-DTj-Tkfr.js";const ce={class:"encoding-progress__compact-info"},ie={class:"ml-2"},ue={key:0,class:"encoding-progress__compact-progress"},de={class:"encoding-progress__compact-percentage"},pe={class:"encoding-progress__compact-actions"},ge={class:"encoding-progress__expanded-content"},ve={class:"encoding-progress__header"},_e={class:"encoding-progress__title"},he={class:"ml-2"},me={class:"encoding-progress__actions"},fe={class:"encoding-progress__content"},ke={key:0,class:"encoding-progress__program-info"},xe={class:"encoding-progress__program-title"},ye={class:"encoding-progress__details"},we={class:"encoding-progress__codec-info"},Ce={key:1,class:"encoding-progress__progress-bar"},Ie={class:"encoding-progress__progress-text"},Te={key:0},Ve={key:1},ze={key:2,class:"encoding-progress__error"},Se=Z({__name:"TSReplaceEncodingProgress",props:{taskId:{},autoHide:{type:Boolean,default:!0}},emits:["completed","failed","cancelled","hidden"],setup(j,{expose:G,emit:J}){const r=j,x=J,I=$(),p=s(()=>r.taskId?I.getTask(r.taskId):null);I.initializeWebSocket();const T=w(!1),m=w(!1),n=w(!1),E=w(!0),B=()=>{n.value=!n.value,E.value=!1},c=s(()=>{var e;return((e=p.value)==null?void 0:e.status)??"queued"}),f=s(()=>{var e;return((e=p.value)==null?void 0:e.progress)??0}),V=s(()=>{var e;return((e=p.value)==null?void 0:e.errorMessage)??""}),M=s(()=>{var e;return((e=p.value)==null?void 0:e.programTitle)??"読み込み中..."}),K=s(()=>{var e;return(e=p.value)==null?void 0:e.codec}),O=s(()=>{var e;return(e=p.value)==null?void 0:e.encoderType});s(()=>{var e;return(e=p.value)==null?void 0:e.startedAt});const P=s(()=>["queued","processing"].includes(c.value)),y=s(()=>c.value==="queued"||c.value==="processing"&&f.value===0),z=s(()=>["queued","processing"].includes(c.value)&&!m.value),b=s(()=>["completed","failed","cancelled"].includes(c.value)),N=s(()=>{switch(c.value){case"queued":return"エンコード待機中";case"processing":return"エンコード中";case"completed":return"エンコード完了";case"failed":return"エンコード失敗";case"cancelled":return"エンコードキャンセル";default:return"状況不明"}}),D=s(()=>{switch(c.value){case"queued":return"fluent:clock-20-regular";case"processing":return"fluent:arrow-sync-20-regular";case"completed":return"fluent:checkmark-circle-20-regular";case"failed":return"fluent:error-circle-20-regular";case"cancelled":return"fluent:dismiss-circle-20-regular";default:return"fluent:question-circle-20-regular"}}),H=s(()=>{switch(c.value){case"processing":return"encoding-progress__icon--spin";case"completed":return"text-success";case"failed":return"text-error";case"cancelled":return"text-warning";default:return"text-primary"}}),R=s(()=>{switch(c.value){case"completed":return"success";case"failed":return"error";case"cancelled":return"warning";default:return"primary"}}),Q=s(()=>{switch(K.value){case"h264":return"H.264";case"hevc":return"H.265";default:return"-"}}),Y=s(()=>{switch(O.value){case"software":return"ソフトウェア";case"hardware":return"ハードウェア";default:return"-"}}),A=async()=>{if(!(!r.taskId||!z.value)){m.value=!0;try{const e=await te.cancelEncoding(r.taskId)}catch(e){console.error("Failed to cancel encoding:",e),re.error("エンコードのキャンセルに失敗しました。")}finally{m.value=!1}}},F=()=>{r.taskId&&(I.removeTask(r.taskId),g())},g=()=>{T.value=!1,x("hidden")},L=()=>{r.taskId&&(T.value=!0)};return U(()=>r.taskId,e=>{e?L():g()},{immediate:!0}),U(c,(e,h)=>{e===h||!r.taskId||(e==="completed"?(x("completed",r.taskId),r.autoHide&&setTimeout(()=>g(),5e3)):e==="failed"?x("failed",r.taskId,V.value||"Unknown error"):e==="cancelled"&&(x("cancelled",r.taskId),r.autoHide&&setTimeout(()=>g(),3e3)))}),G({showProgress:L,hideProgress:g}),(e,h)=>{const u=ee("Icon");return T.value?(o(),v("div",{key:0,class:S(["encoding-progress",{"encoding-progress--collapsed":n.value,"encoding-progress--expanded":!n.value,"encoding-progress--initial-show":E.value}])},[a("div",{class:"encoding-progress__compact-header",onClick:B},[a("div",ce,[t(u,{icon:D.value,class:S(H.value),width:"16px",height:"16px"},null,8,["icon","class"]),a("span",ie,d(N.value),1),P.value&&n.value?(o(),v("div",ue,[t(W,{"model-value":f.value,color:R.value,height:"4",rounded:"",indeterminate:y.value},null,8,["model-value","color","indeterminate"]),a("span",de,d(y.value?"...":Math.round(f.value)+"%"),1)])):i("",!0)]),a("div",pe,[t(_,{size:"x-small",variant:"text",onClick:C(B,["stop"]),class:"mr-1"},{default:l(()=>[t(u,{icon:n.value?"fluent:chevron-down-20-regular":"fluent:chevron-up-20-regular",width:"16px",height:"16px"},null,8,["icon"])]),_:1}),z.value&&n.value?(o(),k(_,{key:0,size:"x-small",variant:"flat",color:"error",onClick:C(A,["stop"]),loading:m.value},{default:l(()=>[t(u,{icon:"fluent:stop-20-regular",width:"14px",height:"14px"})]),_:1},8,["loading"])):i("",!0),b.value&&n.value?(o(),k(_,{key:1,size:"x-small",variant:"flat",color:"grey",onClick:C(F,["stop"])},{default:l(()=>[t(u,{icon:"fluent:delete-20-regular",width:"14px",height:"14px"})]),_:1})):i("",!0),n.value?(o(),k(_,{key:2,size:"x-small",variant:"flat",color:"grey",onClick:C(g,["stop"])},{default:l(()=>[t(u,{icon:"fluent:dismiss-20-regular",width:"14px",height:"14px"})]),_:1})):i("",!0)])]),t(le,null,{default:l(()=>[se(a("div",ge,[a("div",ve,[a("div",_e,[t(u,{icon:D.value,class:S(H.value),width:"20px",height:"20px"},null,8,["icon","class"]),a("span",he,d(N.value),1)]),a("div",me,[z.value?(o(),k(_,{key:0,size:"small",variant:"flat",color:"error",onClick:A,loading:m.value},{default:l(()=>[t(u,{icon:"fluent:stop-20-regular",width:"16px",height:"16px"}),h[0]||(h[0]=a("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["loading"])):i("",!0),b.value?(o(),k(_,{key:1,size:"small",variant:"flat",color:"grey",onClick:F},{default:l(()=>[t(u,{icon:"fluent:delete-20-regular",width:"16px",height:"16px"}),h[1]||(h[1]=a("span",{class:"ml-1"},"削除",-1))]),_:1})):i("",!0),t(_,{size:"small",variant:"flat",color:"grey",onClick:g},{default:l(()=>[t(u,{icon:"fluent:dismiss-20-regular",width:"16px",height:"16px"})]),_:1})])]),a("div",fe,[M.value?(o(),v("div",ke,[a("span",xe,d(M.value),1)])):i("",!0),a("div",ye,[a("div",we,[t(X,{size:"small",color:"primary",variant:"tonal"},{default:l(()=>[q(d(Q.value),1)]),_:1}),t(X,{size:"small",color:"secondary",variant:"tonal",class:"ml-2"},{default:l(()=>[q(d(Y.value),1)]),_:1})])]),P.value?(o(),v("div",Ce,[t(W,{"model-value":f.value,color:R.value,height:"8",rounded:"",indeterminate:y.value},null,8,["model-value","color","indeterminate"]),a("div",Ie,[y.value?(o(),v("span",Ve,"処理中...")):(o(),v("span",Te,d(Math.round(f.value))+"%",1))])])):i("",!0),V.value?(o(),v("div",ze,[t(ne,{type:"error",variant:"tonal",density:"compact"},{default:l(()=>[q(d(V.value),1)]),_:1})])):i("",!0)])],512),[[ae,!n.value]])]),_:1})],2)):i("",!0)}}}),Pe=oe(Se,[["__scopeId","data-v-b023b696"]]);export{Pe as T};
