import{B as I}from"./Breadcrumbs-xSx2t4UD.js";import{H as w,N as B}from"./Navigation-CPvN1oBw.js";import{R as M}from"./ReservationList-CewYn6F9.js";import{S as A}from"./SPHeaderBar-DNRvv57W.js";import{R as S}from"./Reservations-3Hnmaj2J.js";import{d as U,X as i,y as E,ae as H,c as L,a as n,b as p,n as N,ao as l,o as O,_ as P}from"./index-CU3j2ibc.js";import"./VSpacer-DhCidaRv.js";import"./ssrBoot-B4UlnHEu.js";import"./VSwitch-CJjLPevV.js";import"./index-B8N0RYGt.js";import"./VTextField-BVp0Us4U.js";import"./transition-1w05dROL.js";import"./forwardRefs-DboJVnh3.js";import"./VSelectionControl-kaH_hfmY.js";import"./VChip-B2SNpuE3.js";import"./VAvatar-ClRGAtrC.js";import"./VSlider-CyiM0sFr.js";import"./VCheckbox-BLpgfy4A.js";import"./VSelect-Dz3VsJe4.js";import"./VMenu-DLEfKmeQ.js";import"./VDivider-D1-4vxW1.js";import"./dialog-transition-Dri6aOQ3.js";import"./VDialog-C17QySkK.js";import"./VCard-yv7iJ92X.js";import"./VPagination-CFBY3su3.js";const b={class:"route-container"},F={class:"reservations-home-container-wrapper"},T={class:"reservations-home-container"},C=30*1e3,D=10,V=U({__name:"Home",setup($){const c=i([]),u=i(0),r=i(!0),s=i(null),d={upcomingReservations:async()=>{const e=await S.fetchReservations();if(e){const a=l(),v=e.reservations.filter(t=>{const o=l(t.program.start_time),R=o.isAfter(a)&&o.isBefore(a.add(24,"hours")),y=t.is_recording_in_progress;return R||y}).sort((t,o)=>t.is_recording_in_progress&&!o.is_recording_in_progress?-1:!t.is_recording_in_progress&&o.is_recording_in_progress?1:l(t.program.start_time).valueOf()-l(o.program.start_time).valueOf());u.value=v.length,c.value=v.slice(0,D)}}},m=async()=>{try{await Promise.all(Object.values(d).map(e=>e())),r.value=!1}catch(e){console.error("Failed to update reservation sections:",e),r.value=!1}},_=e=>{console.log(`Reservation ${e} deleted, refreshing list...`),m()},g=()=>{s.value===null&&(m(),s.value=window.setInterval(m,C))},f=()=>{s.value!==null&&(clearInterval(s.value),s.value=null)};return E(()=>{g()}),H(()=>{f()}),(e,a)=>(O(),L("div",b,[n(w),p("main",null,[n(B),p("div",F,[n(A),p("div",T,[n(I,{crumbs:[{name:"ホーム",path:"/"},{name:"録画予約",path:"/reservations/",disabled:!0}]}),n(M,{class:N(["reservations-home-container__upcoming-reservations",{"reservations-home-container__upcoming-reservations--loading":c.value.length===0&&r.value}]),title:"放送が近い録画予約",reservations:c.value,total:u.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:r.value,showEmptyMessage:!r.value,emptyIcon:"fluent:timer-20-regular",emptyMessage:"まだ録画予約がありません。",emptySubMessage:"番組表から録画予約を追加できます。",onMore:a[0]||(a[0]=h=>e.$router.push("/reservations/all")),onDelete:_},null,8,["class","reservations","total","isLoading","showEmptyMessage"])])])])]))}}),ve=P(V,[["__scopeId","data-v-f5d1f89d"]]);export{ve as default};
