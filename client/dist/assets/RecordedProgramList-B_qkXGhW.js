import{d as ae,k as $,h as l,a,b as t,w as I,r as X,c as m,e as b,t as u,ah as S,U as D,P as j,aq as we,F as O,o as i,R as q,_ as le,I as xe,J as ke,Y as Ve,x as z,L as $e,aB as Ce,aC as Me,aD as Pe,S as Se,aE as Be,aF as He,W as Te,aG as Re,Q as Ie,aH as ze,aI as Ee,a3 as Le,a4 as De,a5 as Ue,aJ as Ae,aK as Fe,a7 as Oe,aL as We,aM as je,a9 as qe,at as Ne,aN as Ye,aj as Ge,ac as ve,V as Y,ab as de,Z as T,B as Z,z as Qe,l as c,aO as ge,aP as pe,aQ as Je,ap as Ke,M,an as fe,u as Ze,n as N,f as _e,p as W,j as Xe,ak as et,g as tt,am as ot}from"./index-C8qqk6Xt.js";import{V as ne}from"./VDialog-CLA_FvL9.js";import{d as ue,V as ce,b as he,c as be}from"./VCard-C0IPZxWC.js";import{V as me,c as at}from"./VSpacer-cX4zvVU_.js";import{V as se,a as ee}from"./VRow-Cj90kDst.js";import{c as te,V as R,b as lt,a as L,d as st}from"./VSelect-DfIcwawS.js";import{V as oe}from"./VChip-BYCaROFZ.js";import{V as rt}from"./VCheckbox-DbhUaCsB.js";import{V as it}from"./VTooltip-D58RePWn.js";import{V as re}from"./Videos-DA8mQvs2.js";import{V as ye}from"./VDivider-BvVjUXSG.js";import{V as dt}from"./VPagination-DPktGjnX.js";const nt={class:"px-5 pb-6"},ut={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-2"},ct={class:"video-info__item"},mt={class:"video-info__item-value"},vt={class:"video-info__item"},gt={class:"video-info__item-value"},pt={class:"video-info__item"},ft={class:"video-info__item-value"},_t={class:"video-info__item"},yt={class:"video-info__item-value"},ht={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},bt={class:"video-info__item"},wt={class:"video-info__item-value"},xt={class:"video-info__item"},kt={class:"video-info__item-value"},Vt={class:"video-info__item"},$t={class:"video-info__item-value"},Ct={class:"video-info__item"},Mt={class:"video-info__item-value"},Pt={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},St={class:"video-info__item"},Bt={class:"video-info__item-value"},Ht={class:"video-info__item"},Tt={class:"video-info__item-value"},Rt={class:"video-info__item"},It={class:"video-info__item-value"},zt={key:0,class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},Et={class:"video-info__item"},Lt={class:"video-info__item-value"},Dt={class:"video-info__item"},Ut={class:"video-info__item-value"},At={class:"video-info__item"},Ft={class:"video-info__item-value"},Ot=ae({__name:"RecordedFileInfoDialog",props:{program:{},show:{type:Boolean}},emits:["update:show"],setup(e){return(k,s)=>{const n=X("Icon");return i(),$(ne,{"max-width":"770",transition:"slide-y-transition","model-value":e.show,"onUpdate:modelValue":s[1]||(s[1]=w=>k.$emit("update:show",w))},{default:l(()=>[a(ue,{class:"video-info"},{default:l(()=>[a(ce,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:l(()=>[a(n,{icon:"fluent:document-20-filled",height:"26px"}),s[2]||(s[2]=t("span",{class:"ml-3"},"録画ファイル情報",-1)),a(me),I((i(),m("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:s[0]||(s[0]=w=>k.$emit("update:show",!1))},[a(n,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[q]])]),_:1}),t("div",nt,[t("div",ut,[a(n,{icon:"fluent:video-clip-20-filled",width:"24px",height:"20px"}),s[3]||(s[3]=t("span",{class:"ml-2"},"ファイル情報",-1))]),t("div",ct,[s[4]||(s[4]=t("div",{class:"video-info__item-label"},"ファイルパス",-1)),t("div",mt,u(e.program.recorded_video.file_path),1)]),t("div",vt,[s[5]||(s[5]=t("div",{class:"video-info__item-label"},"ファイルサイズ",-1)),t("div",gt,u(S(D).formatBytes(e.program.recorded_video.file_size)),1)]),t("div",pt,[s[6]||(s[6]=t("div",{class:"video-info__item-label"},"録画期間",-1)),t("div",ft,u(S(j).getRecordingTime(e.program)),1)]),t("div",_t,[s[7]||(s[7]=t("div",{class:"video-info__item-label"},"最終更新日時",-1)),t("div",yt,u(S(D).apply28HourClock(S(we)(e.program.recorded_video.file_modified_at).format("YYYY/MM/DD (dd) HH:mm:ss"))),1)]),t("div",ht,[a(n,{icon:"fluent:video-20-filled",width:"24px",height:"20px"}),s[8]||(s[8]=t("span",{class:"ml-2"},"映像情報",-1))]),t("div",bt,[s[9]||(s[9]=t("div",{class:"video-info__item-label"},"コーデック",-1)),t("div",wt,u(e.program.recorded_video.video_codec)+" ("+u(e.program.recorded_video.video_codec_profile)+")",1)]),t("div",xt,[s[10]||(s[10]=t("div",{class:"video-info__item-label"},"解像度",-1)),t("div",kt,u(e.program.recorded_video.video_resolution_width)+"×"+u(e.program.recorded_video.video_resolution_height),1)]),t("div",Vt,[s[11]||(s[11]=t("div",{class:"video-info__item-label"},"フレームレート",-1)),t("div",$t,u(e.program.recorded_video.video_frame_rate)+" fps",1)]),t("div",Ct,[s[12]||(s[12]=t("div",{class:"video-info__item-label"},"スキャン方式",-1)),t("div",Mt,u(e.program.recorded_video.video_scan_type),1)]),t("div",Pt,[a(n,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[13]||(s[13]=t("span",{class:"ml-2"},"音声情報（主音声）",-1))]),t("div",St,[s[14]||(s[14]=t("div",{class:"video-info__item-label"},"コーデック",-1)),t("div",Bt,u(e.program.recorded_video.primary_audio_codec),1)]),t("div",Ht,[s[15]||(s[15]=t("div",{class:"video-info__item-label"},"チャンネル",-1)),t("div",Tt,u(e.program.recorded_video.primary_audio_channel),1)]),t("div",Rt,[s[16]||(s[16]=t("div",{class:"video-info__item-label"},"サンプリングレート",-1)),t("div",It,u(e.program.recorded_video.primary_audio_sampling_rate?`${e.program.recorded_video.primary_audio_sampling_rate/1e3}kHz`:"不明"),1)]),e.program.recorded_video.secondary_audio_codec?(i(),m("div",zt,[a(n,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[17]||(s[17]=t("span",{class:"ml-2"},"音声情報（副音声）",-1))])):b("",!0),e.program.recorded_video.secondary_audio_codec?(i(),m(O,{key:1},[t("div",Et,[s[18]||(s[18]=t("div",{class:"video-info__item-label"},"コーデック",-1)),t("div",Lt,u(e.program.recorded_video.secondary_audio_codec),1)]),t("div",Dt,[s[19]||(s[19]=t("div",{class:"video-info__item-label"},"チャンネル",-1)),t("div",Ut,u(e.program.recorded_video.secondary_audio_channel),1)]),t("div",At,[s[20]||(s[20]=t("div",{class:"video-info__item-label"},"サンプリングレート",-1)),t("div",Ft,u(e.program.recorded_video.secondary_audio_sampling_rate?`${e.program.recorded_video.secondary_audio_sampling_rate/1e3}kHz`:"不明"),1)])],64)):b("",!0)])]),_:1})]),_:1},8,["model-value"])}}}),Wt=le(Ot,[["__scopeId","data-v-fdcb1441"]]),jt=at("v-alert-title"),qt=["success","info","warning","error"],Nt=ke({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Ne,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>qt.includes(e)},...qe(),...je(),...We(),...Oe(),...Fe(),...Ae(),...Ue(),...De(),...Le(),...Ee({variant:"flat"})},"VAlert"),ie=xe()({name:"VAlert",props:Nt(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,k){let{emit:s,slots:n}=k;const w=Ve(e,"modelValue"),v=z(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),P=z(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:p}=$e(e),{colorClasses:d,colorStyles:C,variantClasses:y}=Ce(P),{densityClasses:G}=Me(e),{dimensionStyles:Q}=Pe(e),{elevationClasses:J}=Se(e),{locationStyles:A}=Be(e),{positionClasses:B}=He(e),{roundedClasses:K}=Te(e),{textColorClasses:U,textColorStyles:V}=Re(Ie(e,"borderColor")),{t:r}=ze(),x=z(()=>({"aria-label":r(e.closeLabel),onClick(H){w.value=!1,s("click:close",H)}}));return()=>{const H=!!(n.prepend||v.value),g=!!(n.title||e.title),o=!!(n.close||e.closable);return w.value&&a(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},p.value,d.value,G.value,J.value,B.value,K.value,y.value,e.class],style:[C.value,Q.value,A.value,e.style],role:"alert"},{default:()=>{var f,h;return[Ye(!1,"v-alert"),e.border&&a("div",{key:"border",class:["v-alert__border",U.value],style:V.value},null),H&&a("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?a(ve,{key:"prepend-defaults",disabled:!v.value,defaults:{VIcon:{density:e.density,icon:v.value,size:e.prominent?44:28}}},n.prepend):a(Ge,{key:"prepend-icon",density:e.density,icon:v.value,size:e.prominent?44:28},null)]),a("div",{class:"v-alert__content"},[g&&a(jt,{key:"title"},{default:()=>{var _;return[((_=n.title)==null?void 0:_.call(n))??e.title]}}),((f=n.text)==null?void 0:f.call(n))??e.text,(h=n.default)==null?void 0:h.call(n)]),n.append&&a("div",{key:"append",class:"v-alert__append"},[n.append()]),o&&a("div",{key:"close",class:"v-alert__close"},[n.close?a(ve,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var _;return[(_=n.close)==null?void 0:_.call(n,{props:x.value})]}}):a(Y,de({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},x.value),null)])]}})}}}),Yt={class:"encoding-dialog__program-info mb-4"},Gt={class:"encoding-dialog__program-title"},Qt={key:0,class:"encoding-dialog__program-meta"},Jt={class:"encoding-dialog__program-channel"},Kt={class:"encoding-dialog__program-time"},Zt={class:"encoding-dialog__settings"},Xt={class:"d-flex align-center"},eo={class:"text-caption"},to={class:"d-flex align-center"},oo={class:"text-caption"},ao={class:"d-flex align-center"},lo={class:"text-caption"},so={class:"d-flex align-center"},ro=ae({__name:"TSReplaceEncodingDialog",props:{show:{type:Boolean,default:!1},program:{}},emits:["update:show","encoding-started"],setup(e,{emit:k}){const s=e,n=k,w=z({get:()=>s.show,set:V=>n("update:show",V)}),v=T(!1),P=T(!1),p=T("h264"),d=T("software"),C=T("medium"),y=T(!1),G=[{value:"h264",label:"H.264 (AVC)",description:"互換性が高く、多くのデバイスで再生可能",recommended:!0},{value:"hevc",label:"H.265 (HEVC)",description:"より高い圧縮効率、ファイルサイズが小さくなる",recommended:!1}],Q=z(()=>[{value:"software",label:"ソフトウェアエンコード",description:"FFmpegを使用、時間がかかる",disabled:!1,fast:!1},{value:"hardware",label:"ハードウェアエンコード",description:P.value?"GPU/専用チップを使用、高速で高品質":"使用できません（対応するGPUが検出されませんでした）",disabled:!P.value,fast:!0}]),J=[{value:"fast",label:"高速",description:"エンコード時間を優先、品質は標準的",recommended:!1},{value:"medium",label:"標準",description:"バランスの取れた設定",recommended:!0},{value:"slow",label:"高品質",description:"品質を優先、エンコード時間は長くなる",recommended:!1}],A=z(()=>!(v.value||!s.program||s.program.recorded_video.is_tsreplace_encoded||d.value==="hardware"&&!P.value)),B=async()=>{try{const V=await Je.fetchHardwareEncoderStatus();P.value=V.hardware_encoder_available,!V.hardware_encoder_available&&d.value==="hardware"&&(d.value="software")}catch(V){console.error("Failed to check hardware encoder availability:",V),P.value=!1,d.value==="hardware"&&(d.value="software")}},K=async()=>{var V,r;if(!(!s.program||!A.value)){v.value=!0;try{const x=await Ke.startManualEncoding({video_id:s.program.id,codec:p.value,encoder_type:d.value,quality_preset:C.value,delete_original:y.value});x&&x.success&&x.task_id?(M.success("エンコードを開始しました。"),n("encoding-started",x.task_id,p.value,d.value),v.value=!1,U()):M.error("エンコードの開始に失敗しました。")}catch(x){if(console.error("Failed to start encoding:",x),(r=(V=x==null?void 0:x.response)==null?void 0:V.data)!=null&&r.detail){const H=x.response.data.detail;H==="Cannot re-encode already encoded video"?M.error("再エンコード済みの動画は再度エンコードできません。"):M.error(`エンコードの開始に失敗しました: ${H}`)}else M.error("エンコードの開始に失敗しました。")}finally{v.value=!1}}},U=()=>{v.value||(w.value=!1)};return Z(()=>s.show,V=>{V&&(B(),p.value="h264",d.value="software",C.value="medium",y.value=!1,v.value=!1)}),Qe(()=>{B()}),(V,r)=>{const x=X("Icon");return i(),$(ne,{modelValue:w.value,"onUpdate:modelValue":r[4]||(r[4]=H=>w.value=H),"max-width":"600",persistent:""},{default:l(()=>[a(ue,null,{default:l(()=>[a(ce,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:l(()=>[...r[5]||(r[5]=[c(" 録画ファイルを再エンコード ",-1)])]),_:1}),a(he,{class:"pt-4 pb-0"},{default:l(()=>{var H,g,o,f;return[t("div",Yt,[t("div",Gt,u(((H=e.program)==null?void 0:H.title)||"取得中..."),1),e.program?(i(),m("div",Qt,[t("span",Jt,u(((g=e.program.channel)==null?void 0:g.name)||"チャンネル情報なし"),1),t("span",Kt,u(S(j).getProgramTime(e.program)),1)])):b("",!0)]),t("div",Zt,[a(se,null,{default:l(()=>[a(ee,{cols:"12",md:"6"},{default:l(()=>[a(te,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=h=>p.value=h),items:G,"item-title":"label","item-value":"value",label:"エンコードコーデック",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:v.value},{item:l(({props:h,item:_})=>[a(R,ge(pe(h)),{title:l(()=>[t("div",Xt,[t("span",null,u(_.raw.label),1),_.raw.recommended?(i(),$(oe,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:l(()=>[...r[6]||(r[6]=[c(" 推奨 ",-1)])]),_:1})):b("",!0)])]),subtitle:l(()=>[t("span",eo,u(_.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1}),a(ee,{cols:"12",md:"6"},{default:l(()=>[a(te,{modelValue:d.value,"onUpdate:modelValue":r[1]||(r[1]=h=>d.value=h),items:Q.value,"item-title":"label","item-value":"value",label:"エンコーダータイプ",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:v.value},{item:l(({props:h,item:_})=>[a(R,de(h,{disabled:_.raw.disabled}),{title:l(()=>[t("div",to,[t("span",null,u(_.raw.label),1),_.raw.fast?(i(),$(oe,{key:0,size:"x-small",color:"success",class:"ml-2"},{default:l(()=>[...r[7]||(r[7]=[c(" 高速 ",-1)])]),_:1})):b("",!0)])]),subtitle:l(()=>[t("span",oo,u(_.raw.description),1)]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","disabled"])]),_:1})]),_:1}),a(se,null,{default:l(()=>[a(ee,{cols:"12"},{default:l(()=>[a(te,{modelValue:C.value,"onUpdate:modelValue":r[2]||(r[2]=h=>C.value=h),items:J,"item-title":"label","item-value":"value",label:"エンコード品質",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:v.value},{item:l(({props:h,item:_})=>[a(R,ge(pe(h)),{title:l(()=>[t("div",ao,[t("span",null,u(_.raw.label),1),_.raw.recommended?(i(),$(oe,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:l(()=>[...r[8]||(r[8]=[c(" 推奨 ",-1)])]),_:1})):b("",!0)])]),subtitle:l(()=>[t("span",lo,u(_.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),!P.value&&d.value==="hardware"?(i(),$(ie,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{title:l(()=>[...r[9]||(r[9]=[c("ハードウェアエンコーダーが利用できません",-1)])]),default:l(()=>[r[10]||(r[10]=c(" ハードウェアエンコーダーが検出されないか、設定で無効になっています。",-1)),r[11]||(r[11]=t("br",null,null,-1)),r[12]||(r[12]=c(" ソフトウェアエンコードを使用してください。 ",-1))]),_:1})):b("",!0),(o=e.program)!=null&&o.recorded_video.is_tsreplace_encoded?(i(),$(ie,{key:1,type:"error",variant:"tonal",class:"mt-4"},{title:l(()=>[...r[13]||(r[13]=[c("再エンコード済みの動画です",-1)])]),default:l(()=>[r[14]||(r[14]=c(" この録画ファイルは既に再エンコード済みです。",-1)),r[15]||(r[15]=t("br",null,null,-1)),r[16]||(r[16]=c(" 再エンコード済みの動画は再度エンコードできません。 ",-1))]),_:1})):((f=e.program)==null?void 0:f.recorded_video.video_codec)!=="MPEG-2"?(i(),$(ie,{key:2,type:"info",variant:"tonal",class:"mt-4"},{title:l(()=>[...r[17]||(r[17]=[c("既にエンコード済みのファイルです",-1)])]),default:l(()=>{var h;return[c(" この録画ファイルは既に "+u((h=e.program)==null?void 0:h.recorded_video.video_codec)+" でエンコードされています。",1),r[18]||(r[18]=t("br",null,null,-1)),r[19]||(r[19]=c(" 再エンコードすると画質が劣化する可能性があります。 ",-1))]}),_:1})):b("",!0),a(se,{class:"mt-4"},{default:l(()=>[a(ee,{cols:"12"},{default:l(()=>[a(rt,{modelValue:y.value,"onUpdate:modelValue":r[3]||(r[3]=h=>y.value=h),disabled:v.value,label:"エンコード完了後に元ファイルを削除する","hide-details":"auto"},{label:l(()=>[t("div",so,[r[21]||(r[21]=t("span",null,"エンコード完了後に元ファイルを削除する",-1)),a(it,{activator:"parent",location:"top"},{default:l(()=>[...r[20]||(r[20]=[t("span",null,[c("チェックすると、エンコード完了後に元のファイルが自動的に削除されます。"),t("br"),c(" 削除されたファイルは復元できませんので、十分注意してください。")],-1)])]),_:1})])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})])]}),_:1}),a(be,{class:"pt-4 px-6 pb-6"},{default:l(()=>[a(me),a(Y,{color:"text",variant:"text",onClick:U,disabled:v.value},{default:l(()=>[a(x,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),r[22]||(r[22]=t("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["disabled"]),a(Y,{class:"px-3",color:"primary",variant:"flat",onClick:K,disabled:!A.value,loading:v.value},{default:l(()=>[a(x,{icon:"fluent:arrow-sync-20-regular",width:"18px",height:"18px"}),r[23]||(r[23]=t("span",{class:"ml-1"},"エンコード開始",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),io=le(ro,[["__scopeId","data-v-b3c29d59"]]),no={class:"recorded-program__container"},uo={class:"recorded-program__thumbnail"},co=["src"],mo={class:"recorded-program__thumbnail-duration"},vo={key:0,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--recording"},go={key:1,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--analyzing"},po={key:2,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--partial"},fo={key:3,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoding"},_o={key:4,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoded"},yo={key:5,class:"recorded-program__thumbnail-progress"},ho={key:6,class:"recorded-program__thumbnail-progress recorded-program__thumbnail-progress--encoding"},bo={class:"recorded-program__content"},wo=["innerHTML"],xo={class:"recorded-program__content-meta"},ko={key:0,class:"recorded-program__content-meta-broadcaster"},Vo=["src"],$o={class:"recorded-program__content-meta-broadcaster-name"},Co={key:1,class:"recorded-program__content-meta-broadcaster"},Mo={key:2,class:"recorded-program__content-meta-encoded"},Po={class:"recorded-program__content-meta-time"},So=["innerHTML"],Bo={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},Ho={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},To={key:1,width:"22px",height:"22px",viewBox:"0 0 15.2 15.2"},Ro={class:"recorded-program__menu"},Io={class:"delete-confirmation__file-path mb-4"},zo=ae({__name:"RecordedProgram",props:{program:{},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["deleted","encoding-started"],setup(e,{emit:k}){const s=e,n=k,w=T(!1),v=T(!1),P=T(!1),p=fe(),d=z(()=>p.getAllTasks().some(o=>o.programTitle===s.program.title&&["queued","processing"].includes(o.status))),C=z(()=>{const o=p.getAllTasks().find(f=>f.programTitle===s.program.title&&["queued","processing"].includes(f.status));return o?{progress:o.progress,status:o.status,codec:o.codec,encoderType:o.encoderType}:null}),y=(g="original")=>{const o=`${D.api_base_url}/videos/${s.program.id}/download?file_type=${g}`;window.location.href=o},G=()=>{P.value=!0},Q=(g,o,f)=>{fe().addTask(g,s.program.title,o,f),n("encoding-started",g),console.log("Encoding started with task ID:",g)},J=async()=>{M.success("メタデータの再解析を開始します。完了までしばらくお待ちください。"),await re.reanalyzeVideo(s.program.id)===!0&&M.success("メタデータの再解析が完了しました。")},A=async(g=!1)=>{M.success("サムネイルの再作成を開始しました。完了までしばらくお待ちください。"),await re.regenerateThumbnail(s.program.id,g)===!0&&M.success("サムネイルの再作成が完了しました。")},B=Ze(),K=()=>{B.settings.mylist.some(o=>o.type==="RecordedProgram"&&o.id===s.program.id)?(B.settings.mylist=B.settings.mylist.filter(o=>!(o.type==="RecordedProgram"&&o.id===s.program.id)),M.show("マイリストから削除しました。")):(B.settings.mylist.push({type:"RecordedProgram",id:s.program.id,created_at:D.time()}),M.success("マイリストに追加しました。"))},U=z(()=>B.settings.mylist.some(g=>g.type==="RecordedProgram"&&g.id===s.program.id)),V=z(()=>B.settings.watched_history.find(g=>g.video_id===s.program.id)),r=()=>{B.settings.watched_history=B.settings.watched_history.filter(g=>g.video_id!==s.program.id),M.show("視聴履歴から削除しました。")},x=()=>{const g=et();if(g.user===null||g.user.is_admin===!1){M.warning(`録画ファイルを削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}v.value=!0},H=async()=>{v.value=!1,M.info("録画ファイルの削除を開始します。完了までしばらくお待ちください。"),await re.deleteVideo(s.program.id)===!0&&(M.success("録画ファイルを削除しました。"),n("deleted",s.program.id))};return(g,o)=>{const f=X("Icon"),h=X("router-link"),_=Xe("ftooltip");return i(),m(O,null,[I((i(),$(h,{class:N(["recorded-program",{"recorded-program--recording":e.program.recorded_video.status==="Recording","recorded-program--analyzing":!e.program.recorded_video.has_key_frames,"recorded-program--encoding":d.value}]),to:e.program.recorded_video.status==="Recording"||!e.program.recorded_video.has_key_frames||d.value?{path:""}:`/videos/watch/${e.program.id}`},{default:l(()=>{var E;return[t("div",no,[t("div",uo,[t("img",{class:"recorded-program__thumbnail-image",loading:"lazy",decoding:"async",src:`${S(D).api_base_url}/videos/${e.program.id}/thumbnail`},null,8,co),t("div",mo,u(S(j).getProgramDuration(e.program)),1),e.program.recorded_video.status==="Recording"?(i(),m("div",vo,[...o[14]||(o[14]=[t("div",{class:"recorded-program__thumbnail-status-dot"},null,-1),c(" 録画中 ",-1)])])):e.program.recorded_video.has_key_frames?e.program.is_partially_recorded?(i(),m("div",po," ⚠️ 一部のみ録画 ")):d.value&&C.value?(i(),m("div",fo,[a(f,{icon:"fluent:arrow-sync-12-regular",width:"15px",height:"15px",class:"recorded-program__thumbnail-status-icon--spin"}),c(" エンコード中 ("+u(Math.round(C.value.progress))+"%) ",1)])):(E=e.program)!=null&&E.recorded_video.is_tsreplace_encoded?(i(),m("div",_o,[a(f,{icon:"fluent:checkmark-circle-12-regular",width:"15px",height:"15px"}),o[16]||(o[16]=c(" 再エンコード済み ",-1))])):b("",!0):(i(),m("div",go,[a(f,{icon:"fluent:clock-12-regular",width:"15px",height:"15px"}),o[15]||(o[15]=c(" メタデータ解析中 ",-1))])),V.value&&!d.value?(i(),m("div",yo,[t("div",{class:"recorded-program__thumbnail-progress-bar",style:_e(`width: ${V.value.last_playback_position/e.program.recorded_video.duration*100}%`)},null,4)])):d.value&&C.value?(i(),m("div",ho,[t("div",{class:"recorded-program__thumbnail-progress-bar recorded-program__thumbnail-progress-bar--encoding",style:_e(`width: ${C.value.progress}%`)},null,4)])):b("",!0)]),t("div",bo,[t("div",{class:"recorded-program__content-title",innerHTML:S(j).decorateProgramInfo(e.program,"title")},null,8,wo),t("div",xo,[e.program.channel?(i(),m("div",ko,[t("img",{class:"recorded-program__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${S(D).api_base_url}/channels/${e.program.channel.id}/logo`},null,8,Vo),t("span",$o,"Ch: "+u(e.program.channel.channel_number)+" "+u(e.program.channel.name),1)])):(i(),m("div",Co,[...o[17]||(o[17]=[t("span",{class:"recorded-program__content-meta-broadcaster-name"},"チャンネル情報なし",-1)])])),e.program.recorded_video.is_tsreplace_encoded?(i(),m("div",Mo,[a(oe,{size:"x-small",color:"success",variant:"tonal"},{default:l(()=>[a(f,{icon:"fluent:checkmark-circle-12-regular",width:"12px",height:"12px",class:"mr-1"}),o[18]||(o[18]=c(" 再エンコード済み ",-1))]),_:1})])):b("",!0),t("div",Po,u(S(j).getProgramTime(e.program)),1)]),t("div",{class:"recorded-program__content-description",innerHTML:S(j).decorateProgramInfo(e.program,"description")},null,8,So)]),e.forWatchedHistory?b("",!0):I((i(),m("div",{key:0,class:N(["recorded-program__mylist",{"recorded-program__mylist--highlight":U.value&&!e.forMylist}]),onClick:W(K,["prevent","stop"]),onMousedown:o[0]||(o[0]=W(()=>{},["prevent","stop"]))},[e.forMylist?(i(),m("svg",Bo,[...o[19]||(o[19]=[t("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"},null,-1)])])):(i(),m(O,{key:1},[U.value?(i(),m("svg",Ho,[...o[20]||(o[20]=[t("path",{fill:"currentColor",d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032"},null,-1)])])):(i(),m("svg",To,[...o[21]||(o[21]=[t("path",{fill:"currentColor",d:"M8 2.5a.5.5 0 0 0-1 0V7H2.5a.5.5 0 0 0 0 1H7v4.5a.5.5 0 0 0 1 0V8h4.5a.5.5 0 0 0 0-1H8z"},null,-1)])]))],64))],34)),[[q],[_,U.value?"マイリストから削除する":"マイリストに追加する"]]),e.forWatchedHistory?I((i(),m("div",{key:1,class:"recorded-program__mylist",onClick:W(r,["prevent","stop"]),onMousedown:o[1]||(o[1]=W(()=>{},["prevent","stop"]))},[...o[22]||(o[22]=[t("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)])],32)),[[q],[_,"視聴履歴から削除する"]]):b("",!0),t("div",Ro,[a(st,{location:"bottom end","close-on-content-click":!0},{activator:l(({props:F})=>[I((i(),m("div",de({class:"recorded-program__menu-button"},F,{onClick:o[2]||(o[2]=W(()=>{},["prevent","stop"])),onMousedown:o[3]||(o[3]=W(()=>{},["prevent","stop"]))}),[...o[23]||(o[23]=[t("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)])],16)),[[q]])]),default:l(()=>[a(lt,{density:"compact","bg-color":"background-lighten-1",class:"recorded-program__menu-list"},{default:l(()=>[a(R,{onClick:o[4]||(o[4]=F=>w.value=!0)},{prepend:l(()=>[...o[24]||(o[24]=[t("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[25]||(o[25]=[c("録画ファイル情報を表示",-1)])]),_:1})]),_:1}),e.program.recorded_video.is_tsreplace_encoded?(i(),m(O,{key:0},[a(R,{onClick:o[5]||(o[5]=F=>y("original")),disabled:e.program.recorded_video.status==="Recording"||d.value},{prepend:l(()=>[a(f,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[c("元ファイルをダウンロード ("+u(S(D).formatBytes(e.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"]),a(R,{onClick:o[6]||(o[6]=F=>y("encoded")),disabled:e.program.recorded_video.status==="Recording"||d.value},{prepend:l(()=>[a(f,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[26]||(o[26]=[c("エンコード済みファイルをダウンロード",-1)])]),_:1})]),_:1},8,["disabled"])],64)):(i(),$(R,{key:1,onClick:o[7]||(o[7]=F=>y("original")),disabled:e.program.recorded_video.status==="Recording"||d.value},{prepend:l(()=>[a(f,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[c("録画ファイルをダウンロード ("+u(S(D).formatBytes(e.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"])),I((i(),$(R,{onClick:J},{prepend:l(()=>[a(f,{icon:"fluent:book-arrow-clockwise-20-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[27]||(o[27]=[c("メタデータを再解析",-1)])]),_:1})]),_:1})),[[_,"再生時に必要な録画ファイル情報や番組情報などを解析し直します"]]),I((i(),$(R,{onClick:o[8]||(o[8]=F=>A(!0))},{prepend:l(()=>[a(f,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[28]||(o[28]=[c("サムネイルを更新",-1)])]),_:1})]),_:1})),[[_,"既存のシークバー用サムネイルから代表サムネイルを選び直します 変更反映にはブラウザキャッシュの削除が必要です"]]),I((i(),$(R,{onClick:o[9]||(o[9]=F=>A(!1))},{prepend:l(()=>[a(f,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[29]||(o[29]=[c("サムネイルを再作成",-1)])]),_:1})]),_:1})),[[_,"サムネイルを完全に作り直します（数分かかります） 変更反映にはブラウザキャッシュの削除が必要です"]]),a(ye),I((i(),$(R,{onClick:G,disabled:e.program.recorded_video.status==="Recording"||d.value||e.program.recorded_video.is_tsreplace_encoded},{prepend:l(()=>[a(f,{icon:"fluent:arrow-sync-20-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[30]||(o[30]=[c("録画ファイルを再エンコード",-1)])]),_:1})]),_:1},8,["disabled"])),[[_,e.program.recorded_video.is_tsreplace_encoded?"再エンコード済みの動画は再度エンコードできません":"録画ファイルをH.264またはHEVCに再エンコードします"]]),a(ye),a(R,{onClick:x,disabled:e.program.recorded_video.status==="Recording"||d.value,class:"recorded-program__menu-list-item--danger"},{prepend:l(()=>[a(f,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:l(()=>[a(L,{class:"ml-3"},{default:l(()=>[...o[31]||(o[31]=[c("録画ファイルを削除",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})])])]}),_:1},8,["to","class"])),[[q]]),a(Wt,{program:e.program,show:w.value,"onUpdate:show":o[10]||(o[10]=E=>w.value=E)},null,8,["program","show"]),a(ne,{"max-width":"750",modelValue:v.value,"onUpdate:modelValue":o[12]||(o[12]=E=>v.value=E)},{default:l(()=>[a(ue,null,{default:l(()=>[a(ce,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:l(()=>[...o[32]||(o[32]=[c("本当に録画ファイルを削除しますか？",-1)])]),_:1}),a(he,{class:"pt-2 pb-0"},{default:l(()=>[t("div",Io,u(e.program.recorded_video.file_path),1),o[33]||(o[33]=t("div",{class:"text-error-lighten-1 font-weight-bold"},[c(" この録画ファイルに関連するすべてのデータ (サムネイル / .ts.program.txt / .ts.err を含む) が削除されます。"),t("br"),c(" 元に戻すことはできません。本当に録画ファイルを削除しますか？ ")],-1))]),_:1}),a(be,{class:"pt-4 px-6 pb-6"},{default:l(()=>[a(me),a(Y,{color:"text",variant:"text",onClick:o[11]||(o[11]=E=>v.value=!1)},{default:l(()=>[a(f,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),o[34]||(o[34]=t("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),a(Y,{class:"px-3",color:"error",variant:"flat",onClick:H},{default:l(()=>[a(f,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),o[35]||(o[35]=t("span",{class:"ml-1"},"録画ファイルを削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(io,{show:P.value,"onUpdate:show":o[13]||(o[13]=E=>P.value=E),program:e.program,onEncodingStarted:Q},null,8,["show","program"])],64)}}}),Eo=le(zo,[["__scopeId","data-v-7889d868"]]),Lo={key:0,class:"recorded-program-list__header"},Do={class:"recorded-program-list__title"},Uo={class:"recorded-program-list__title-text"},Ao={key:1,class:"recorded-program-list__title-count"},Fo={class:"recorded-program-list__empty-content"},Oo=["innerHTML"],Wo=["innerHTML"],jo={class:"recorded-program-list__grid-content"},qo={key:1,class:"recorded-program-list__pagination"},No=ae({__name:"RecordedProgramList",props:{title:{},programs:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more"],setup(e){ot();const k=e,s=T(k.page),n=T(k.sortOrder),w=T([...k.programs]),v=T(k.total);Z(()=>k.page,p=>{s.value=p}),Z(()=>k.sortOrder,p=>{n.value=p}),Z(()=>k.programs,p=>{w.value=[...p]}),Z(()=>k.total,p=>{v.value=p});const P=p=>{w.value=w.value.filter(d=>d.id!==p),v.value--};return(p,d)=>{const C=X("Icon");return i(),m("div",{class:N(["recorded-program-list",{"recorded-program-list--show-sort":!e.hideSort}])},[e.hideHeader?b("",!0):(i(),m("div",Lo,[t("h2",Do,[e.showBackButton?I((i(),m("div",{key:0,class:"recorded-program-list__title-back",onClick:d[0]||(d[0]=y=>p.$router.back())},[a(C,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[q]]):b("",!0),t("span",Uo,u(e.title),1),e.showMoreButton?b("",!0):(i(),m("div",Ao,[e.isSearching?(i(),m(O,{key:0},[a(C,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),d[6]||(d[6]=t("span",null,"検索中...",-1))],64)):(i(),m(O,{key:1},[c(u(v.value)+"件",1)],64))]))]),t("div",{class:N(["recorded-program-list__actions",{"recorded-program-list__actions--mylist":e.forMylist}])},[e.hideSort?b("",!0):(i(),$(te,{key:0,modelValue:n.value,"onUpdate:modelValue":[d[1]||(d[1]=y=>n.value=y),d[2]||(d[2]=y=>p.$emit("update:sortOrder",y))],items:e.forMylist?[{title:"追加が新しい順",value:"mylist_added_desc"},{title:"追加が古い順",value:"mylist_added_asc"},{title:"録画が新しい順",value:"recorded_desc"},{title:"録画が古い順",value:"recorded_asc"}]:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"recorded-program-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue","items"])),e.showMoreButton?(i(),$(Y,{key:1,variant:"text",class:"recorded-program-list__more",onClick:d[3]||(d[3]=y=>p.$emit("more"))},{default:l(()=>[d[7]||(d[7]=t("span",{class:"text-primary"},"もっと見る",-1)),a(C,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):b("",!0)],2)])),t("div",{class:N(["recorded-program-list__grid",{"recorded-program-list__grid--loading":e.isLoading||e.isSearching,"recorded-program-list__grid--empty":v.value===0&&e.showEmptyMessage,"recorded-program-list__grid--searching":e.isSearching}])},[t("div",{class:N(["recorded-program-list__empty",{"recorded-program-list__empty--show":v.value===0&&e.showEmptyMessage&&!e.isSearching}])},[t("div",Fo,[a(C,{class:"recorded-program-list__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),t("h2",{innerHTML:e.emptyMessage},null,8,Oo),e.emptySubMessage?(i(),m("div",{key:0,class:"recorded-program-list__empty-submessage",innerHTML:e.emptySubMessage},null,8,Wo)):b("",!0)])],2),t("div",jo,[(i(!0),m(O,null,tt(w.value,y=>(i(),$(Eo,{key:y.id,program:y,forMylist:e.forMylist,forWatchedHistory:e.forWatchedHistory,onDeleted:P},null,8,["program","forMylist","forWatchedHistory"]))),128))])],2),!e.hidePagination&&v.value>0?(i(),m("div",qo,[a(dt,{modelValue:s.value,"onUpdate:modelValue":[d[4]||(d[4]=y=>s.value=y),d[5]||(d[5]=y=>p.$emit("update:page",y))],"active-color":"primary",density:"comfortable",length:Math.ceil(v.value/30),"total-visible":S(D).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):b("",!0)],2)}}}),sa=le(No,[["__scopeId","data-v-f7a7f4da"]]);export{sa as R,ie as V};
