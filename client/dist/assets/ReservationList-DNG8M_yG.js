import{d as j,af as re,Z as w,B as R,z as Y,aQ as ee,w as O,c as v,n as T,b as e,e as V,t as m,a as i,ah as S,P as B,h as P,l as $,r as q,U as L,M as F,o,R as N,_ as J,F as A,g as W,cr as K,x as I,f as U,i as se,k as z,V as G}from"./index-CAOTUcHN.js";import{R as X}from"./Reservations-BFoStn4S.js";import{V as te}from"./VSwitch-CB2EKF8v.js";import{V as ne}from"./VChip-CG3DmiAu.js";import{u as ie}from"./Navigation-BP6Qs9qF.js";import{V as ae}from"./VSlider-C6YPV7U5.js";import{b as H}from"./VTextField-DIbiQ9M7.js";import{V as oe}from"./VCheckbox-BzzF7fLP.js";import{c as Z}from"./VSelect-BXbYwWA5.js";import{V as le}from"./VDialog-B3ZhW_k_.js";import{d as de,V as ce,b as ve,c as ue}from"./VCard-3Z-MKc6B.js";import{V as ge}from"./VSpacer-DeXG8oCu.js";import{V as _e}from"./VPagination-ftXtxN91.js";const me={class:"reservation__container"},pe={class:"reservation__controls"},fe={key:0,class:"reservation__priority"},be={class:"reservation__priority-badge"},he={class:"reservation__toggle-label"},ye={key:2,class:"reservation__recording"},we={class:"reservation__content"},Ve={class:"reservation__content-header"},$e=["innerHTML"],xe={class:"reservation__content-status"},ke={class:"reservation__content-meta"},Se={class:"reservation__content-meta-broadcaster"},Ce=["src"],Ee={class:"reservation__content-meta-broadcaster-name"},Pe={class:"reservation__content-meta-time"},Re={class:"reservation__content-meta-size-comment"},De={key:0,class:"reservation__content-meta-comment"},Me={class:"reservation__content-meta-comment-text"},Te={class:"reservation__content-meta-size"},Ue={class:"reservation__content-meta-time-pc"},Be={class:"reservation__content-description-container"},Le=["innerHTML"],Ie={class:"reservation__content-description-size-pc"},He=j({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(t,{emit:C}){const c=t,x=C;re();const f=w("EDCB"),a=w(c.reservation.record_settings.is_enabled),u=w(!1);R(()=>c.reservation.record_settings.is_enabled,n=>{a.value=f.value==="EPGStation"?!0:n}),R(f,n=>{n==="EPGStation"&&(a.value=!0)});const s=n=>{const y=n.target;y.src=`${L.api_base_url}/channels/gr001/logo`},h=n=>{if(n.is_recording_in_progress)return"録画中";switch(n.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},k=n=>{if(n.is_recording_in_progress)return"fluent:record-16-filled";switch(n.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},D=n=>{if(n.is_recording_in_progress)return"primary";switch(n.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},M=()=>{x("click",c.reservation)},E=async()=>{if(f.value!=="EDCB"){a.value=!0;return}if(!u.value){u.value=!0;try{const n={...c.reservation.record_settings,is_enabled:a.value};if(await X.updateReservation(c.reservation.id,n)){const p=a.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;F.success(p)}else a.value=c.reservation.record_settings.is_enabled}catch(n){console.error("Failed to update reservation:",n),a.value=c.reservation.record_settings.is_enabled}finally{u.value=!1}}},_=n=>{n.stopPropagation()};return Y(async()=>{const n=await ee.fetchServerSettings();n&&(f.value=n.general.recorder)}),(n,y)=>{const p=q("Icon");return O((o(),v("div",{class:T(["reservation",{"reservation--disabled":!a.value}]),onClick:M},[e("div",me,[e("div",pe,[f.value==="EDCB"?(o(),v("div",fe,[e("div",be,m(t.reservation.record_settings.priority),1),y[1]||(y[1]=e("div",{class:"reservation__priority-label"},"優先度",-1))])):V("",!0),t.reservation.is_recording_in_progress?(o(),v("div",ye,[...y[2]||(y[2]=[e("div",{class:"reservation__recording-icon"},null,-1)])])):(o(),v("div",{key:1,class:T(["reservation__toggle",{"reservation__toggle--disabled":f.value==="EPGStation"}]),onClick:_},[i(te,{modelValue:a.value,"onUpdate:modelValue":[y[0]||(y[0]=d=>a.value=d),E],disabled:f.value==="EPGStation",color:"primary",density:"compact","hide-details":"",onClick:_},null,8,["modelValue","disabled"]),e("div",he,m(a.value?"有効":"無効"),1)],2))]),e("div",we,[e("div",Ve,[e("div",{class:"reservation__content-title",innerHTML:S(B).decorateProgramInfo(t.reservation.program,"title")},null,8,$e),e("div",xe,[i(ne,{color:D(t.reservation),size:"small",variant:"tonal"},{default:P(()=>[i(p,{icon:k(t.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),$(" "+m(h(t.reservation)),1)]),_:1},8,["color"])])]),e("div",ke,[e("div",Se,[e("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${S(L).api_base_url}/channels/${t.reservation.channel.id}/logo`,onError:s},null,40,Ce),e("span",Ee,"Ch: "+m(t.reservation.channel.channel_number)+" "+m(t.reservation.channel.name),1)]),e("div",Pe,m(S(B).getProgramTime(t.reservation.program)),1),e("div",Re,[t.reservation.comment?(o(),v("div",De,[i(p,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),e("span",Me,m(t.reservation.comment),1)])):V("",!0),e("div",Te,[i(p,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),$(" 約 "+m(S(L).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])]),e("div",Ue,m(S(B).getProgramTime(t.reservation.program)),1)]),e("div",Be,[e("div",{class:"reservation__content-description",innerHTML:S(B).decorateProgramInfo(t.reservation.program,"description")},null,8,Le),e("div",Ie,[i(p,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),$(" 約 "+m(S(L).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[N]])}}}),Fe=J(He,[["__scopeId","data-v-970f0d90"]]),ze=j({name:"ReservationProgramInfo",props:{reservation:{type:Object,required:!0}},data(){return{Utils:Object.freeze(L),ProgramUtils:Object.freeze(B)}},methods:{onLogoError(t){const C=t.target;C.src=`${L.api_base_url}/channels/gr001/logo`}}}),Ge={class:"program-container"},Oe={class:"program-info"},Ne=["innerHTML"],Ae={class:"program-info__broadcaster"},je=["src"],qe={class:"program-info__broadcaster-container"},Je={class:"d-flex align-center"},Ke={class:"program-info__broadcaster-number"},Ze={class:"program-info__broadcaster-name"},Qe={class:"program-info__broadcaster-time"},We=["innerHTML"],Xe={class:"program-info__genre-container"},Ye={class:"mt-5"},et={class:"program-info__status"},tt={class:"ml-2"},rt={class:"program-info__status"},st={class:"ml-2"},nt={key:0,class:"program-info__status"},it={class:"ml-2"},at={class:"program-detail-container"},ot={class:"program-detail__heading"},lt=["innerHTML"];function dt(t,C,c,x,f,a){const u=q("Icon");return o(),v("div",Ge,[e("section",Oe,[e("h1",{class:"program-info__title",innerHTML:t.ProgramUtils.decorateProgramInfo(t.reservation.program,"title")},null,8,Ne),e("div",Ae,[e("img",{class:"program-info__broadcaster-icon",src:`${t.Utils.api_base_url}/channels/${t.reservation.channel.id}/logo`,onError:C[0]||(C[0]=(...s)=>t.onLogoError&&t.onLogoError(...s))},null,40,je),e("div",qe,[e("div",Je,[e("div",Ke,"Ch: "+m(t.reservation.channel.channel_number),1),e("div",Ze,m(t.reservation.channel.name),1)]),e("div",Qe,m(t.ProgramUtils.getProgramTime(t.reservation.program)),1)])]),e("div",{class:"program-info__description",innerHTML:t.ProgramUtils.decorateProgramInfo(t.reservation.program,"description")},null,8,We),e("div",Xe,[(o(!0),v(A,null,W(t.reservation.program.genres??[],(s,h)=>(o(),v("div",{class:"program-info__genre",key:h},m(s.major)+" / "+m(s.middle),1))),128))]),e("div",Ye,[e("div",et,[i(u,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",tt,"映像: "+m(t.reservation.program.video_codec)+" / "+m(t.reservation.program.video_resolution),1)]),e("div",rt,[i(u,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",st,"主音声: "+m(t.reservation.program.primary_audio_type)+" "+m(t.reservation.program.primary_audio_sampling_rate||"Unknown")+" / "+m(t.reservation.program.primary_audio_language),1)]),t.reservation.program.secondary_audio_type?(o(),v("div",nt,[i(u,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",it,"副音声: "+m(t.reservation.program.secondary_audio_type)+" "+m(t.reservation.program.secondary_audio_sampling_rate||"Unknown")+" / "+m(t.reservation.program.secondary_audio_language),1)])):V("",!0)])]),e("section",at,[(o(!0),v(A,null,W(t.reservation.program.detail??{},(s,h)=>(o(),v("div",{class:"program-detail",key:h},[e("h2",ot,m(h),1),e("div",{class:"program-detail__text",innerHTML:t.Utils.URLtoLink(s)},null,8,lt)]))),128))])])}const ct=J(ze,[["render",dt],["__scopeId","data-v-18bc390b"]]),vt={class:"reservation-recording-settings"},ut={key:0,class:"recording-warning-banner"},gt={class:"reservation-recording-settings__header"},_t={class:"reservation-recording-settings__slider"},mt={class:"reservation-recording-settings__section"},pt={class:"reservation-recording-settings__section"},ft={class:"reservation-recording-settings__margin-default"},bt={class:"reservation-recording-settings__margin-controls"},ht={class:"reservation-recording-settings__description"},yt=j({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(t,{emit:C}){const c=t,x=C,f=ie(),a=w("EDCB"),u=()=>{a.value==="EPGStation"&&(s.value.is_enabled=!0,h.value.is_enabled=!0)},s=w(structuredClone(K(c.reservation.record_settings))),h=w(structuredClone(K(c.reservation.record_settings))),k=I({get:()=>s.value.recording_folders.length>0?s.value.recording_folders[0].recording_folder_path:"",set:g=>{M(g,D.value)}}),D=I({get:()=>s.value.recording_folders.length>0&&s.value.recording_folders[0].recording_file_name_template||"",set:g=>{M(k.value,g)}}),M=(g,r)=>{const Q=g.trim()!=="",b=r.trim()!=="";!Q&&!b?s.value.recording_folders=[]:(s.value.recording_folders.length===0&&s.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),s.value.recording_folders[0].recording_folder_path=g,s.value.recording_folders[0].recording_file_name_template=r||null)},E=w(s.value.recording_start_margin===null&&s.value.recording_end_margin===null),_=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],n=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],y=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],p=I(()=>JSON.stringify(s.value)!==JSON.stringify(h.value));R(p,g=>{x("changesDetected",g)});const d=()=>{u(),x("updateSettings",s.value)},l=()=>{E.value?(s.value.recording_start_margin=null,s.value.recording_end_margin=null):(s.value.recording_start_margin=10,s.value.recording_end_margin=5),d()};return R(()=>c.reservation,g=>{s.value=structuredClone(K(g.record_settings)),h.value=structuredClone(K(g.record_settings)),u()},{deep:!0}),Y(async()=>{await f.fetchServerVersion();const g=await ee.fetchServerSettings();g&&(a.value=g.general.recorder),u()}),R(a,()=>{u()}),(g,r)=>{const Q=q("Icon");return o(),v("div",vt,[t.reservation.is_recording_in_progress?(o(),v("div",ut,[i(Q,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),r[11]||(r[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):V("",!0),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[e("div",gt,[r[12]||(r[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),i(te,{disabled:t.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:s.value.is_enabled,"onUpdate:modelValue":[r[0]||(r[0]=b=>s.value.is_enabled=b),d],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),r[13]||(r[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[$(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),$(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))],4),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[14]||(r[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),r[15]||(r[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",_t,[i(ae,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.priority,"onUpdate:modelValue":[r[1]||(r[1]=b=>s.value.priority=b),d],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])],4),e("div",mt,[r[16]||(r[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),r[17]||(r[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),i(H,{disabled:t.reservation.is_recording_in_progress,modelValue:k.value,"onUpdate:modelValue":[r[2]||(r[2]=b=>k.value=b),d],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:S(f).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",pt,[r[18]||(r[18]=se('<div class="reservation-recording-settings__label" data-v-7cdf7324>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-7cdf7324> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-7cdf7324><div class="mt-1" data-v-7cdf7324><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-7cdf7324>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-7cdf7324>xtne6f 版での追加差分</a></div></div>',2)),i(H,{disabled:t.reservation.is_recording_in_progress,modelValue:D.value,"onUpdate:modelValue":[r[3]||(r[3]=b=>D.value=b),d],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[20]||(r[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),r[21]||(r[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",ft,[i(oe,{disabled:t.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:E.value,"onUpdate:modelValue":[r[4]||(r[4]=b=>E.value=b),l],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),r[19]||(r[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",bt,[i(H,{disabled:t.reservation.is_recording_in_progress||E.value,modelValue:s.value.recording_start_margin,"onUpdate:modelValue":[r[5]||(r[5]=b=>s.value.recording_start_margin=b),d],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),i(H,{disabled:t.reservation.is_recording_in_progress||E.value,modelValue:s.value.recording_end_margin,"onUpdate:modelValue":[r[6]||(r[6]=b=>s.value.recording_end_margin=b),d],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])],4),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[22]||(r[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),r[23]||(r[23]=e("div",{class:"reservation-recording-settings__description"},[$(" 字幕データはほとんど録画容量を消費しません。"),e("br"),$(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),i(Z,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.caption_recording_mode,"onUpdate:modelValue":[r[7]||(r[7]=b=>s.value.caption_recording_mode=b),d],items:_,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[24]||(r[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),r[25]||(r[25]=e("div",{class:"reservation-recording-settings__description"},[$(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),$(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),i(Z,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[r[8]||(r[8]=b=>s.value.data_broadcasting_recording_mode=b),d],items:n,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[26]||(r[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),r[27]||(r[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),i(Z,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_mode,"onUpdate:modelValue":[r[9]||(r[9]=b=>s.value.post_recording_mode=b),d],items:y,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])],4),e("div",{class:"reservation-recording-settings__section",style:U(a.value==="EPGStation"?{opacity:.5,pointerEvents:"none"}:{})},[r[28]||(r[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",ht," 通常は空欄のままで大丈夫です。録画後に指定の "+m(S(f).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),i(H,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_bat_file_path,"onUpdate:modelValue":[r[10]||(r[10]=b=>s.value.post_recording_bat_file_path=b),d],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:S(f).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])],4)])}}}),wt=J(yt,[["__scopeId","data-v-7cdf7324"]]),Vt={class:"reservation-detail-drawer__header"},$t={class:"reservation-detail-drawer__tabs"},xt={class:"reservation-detail-drawer__content"},kt={key:0,class:"reservation-detail-drawer__info"},St={key:1,class:"reservation-detail-drawer__settings"},Ct={class:"reservation-detail-drawer__footer"},Et={class:"reservation-detail-drawer__actions"},Pt={key:0,class:"mb-4"},Rt=["innerHTML"],Dt={class:"text-body-2 text-text-darken-1"},Mt={key:1,class:"warning-banner warning-banner--recording"},Tt={key:2,class:"warning-banner warning-banner--normal"},Ut={key:3,class:"warning-banner warning-banner--keyword mt-3"},Bt=j({__name:"ReservationDetailDrawer",props:{reservation:{},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted"],setup(t,{emit:C}){const c=t,x=C,f=I({get:()=>c.modelValue,set:d=>x("update:modelValue",d)}),a=w("info"),u=w(!1),s=w(!1),h=w(null),k=w(!1),D=I(()=>{var d;return((d=c.reservation)==null?void 0:d.comment.includes("EPG自動予約"))??!1}),M=I(()=>{var d;return((d=c.reservation)==null?void 0:d.is_recording_in_progress)??!1});R(f,d=>{d?(a.value="info",u.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const E=()=>{u.value&&!confirm("変更が保存されていません。ドロワーを閉じますか？")||(f.value=!1)},_=d=>{h.value=d},n=async()=>{if(!u.value||s.value||!h.value||!c.reservation)return;const d=h.value.caption_recording_mode==="Default",l=h.value.data_broadcasting_recording_mode==="Default";if(d!==l){F.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}s.value=!0;try{if(await X.updateReservation(c.reservation.id,h.value)){F.success("録画設定の変更を保存しました。");const r={...c.reservation,record_settings:h.value};x("updated",r),u.value=!1}}catch(g){console.error("Failed to save settings:",g),F.error("録画設定の保存に失敗しました。")}finally{s.value=!1}},y=()=>{k.value=!0},p=async()=>{if(k.value=!1,!!c.reservation)try{await X.deleteReservation(c.reservation.id)&&(F.success("録画予約を削除しました。"),x("deleted",c.reservation.id),f.value=!1)}catch(d){console.error("Failed to delete reservation:",d)}};return(d,l)=>{const g=q("Icon");return o(),v(A,null,[e("div",{class:T(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":f.value}]),onClick:E},null,2),e("div",{class:T(["reservation-detail-drawer",{"reservation-detail-drawer--visible":f.value}])},[e("div",Vt,[e("div",$t,[O((o(),v("div",{class:T(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":a.value==="info"}]),onClick:l[0]||(l[0]=r=>a.value="info")},[i(g,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),l[5]||(l[5]=e("span",{class:"reservation-detail-drawer__tab-text"},"番組情報",-1))],2)),[[N]]),O((o(),v("div",{class:T(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":a.value==="settings"}]),onClick:l[1]||(l[1]=r=>a.value="settings")},[i(g,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),l[6]||(l[6]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[N]])]),O((o(),v("div",{class:"reservation-detail-drawer__close",onClick:E},[i(g,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[N]])]),e("div",xt,[a.value==="info"&&t.reservation?(o(),v("div",kt,[i(ct,{reservation:t.reservation},null,8,["reservation"])])):V("",!0),a.value==="settings"&&t.reservation?(o(),v("div",St,[i(wt,{reservation:t.reservation,"has-changes":u.value,onUpdateSettings:_,onChangesDetected:l[2]||(l[2]=r=>u.value=r)},null,8,["reservation","has-changes"])])):V("",!0)]),e("div",Ct,[e("div",Et,[i(G,{class:"px-3",variant:"text",onClick:y},{default:P(()=>[i(g,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),l[7]||(l[7]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1}),a.value==="settings"?(o(),z(G,{key:0,class:"px-3",color:"secondary",variant:"flat",disabled:!u.value,loading:s.value,onClick:n},{default:P(()=>[i(g,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),l[8]||(l[8]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):V("",!0)])])],2),i(le,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=r=>k.value=r),"max-width":"715"},{default:P(()=>[i(de,null,{default:P(()=>[i(ce,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:P(()=>[...l[9]||(l[9]=[$(" 録画予約を削除しますか？ ",-1)])]),_:1}),i(ve,{class:"pt-2 pb-0"},{default:P(()=>[t.reservation?(o(),v("div",Pt,[e("div",{class:"text-h6 text-text mb-2",innerHTML:S(B).decorateProgramInfo(t.reservation.program,"title")},null,8,Rt),e("div",Dt,m(S(B).getProgramTime(t.reservation.program)),1)])):V("",!0),M.value&&t.reservation?(o(),v("div",Mt,[i(g,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),l[10]||(l[10]=e("span",{class:"warning-banner__text"},[$(" この番組は現在録画中です。"),e("br"),$(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):t.reservation?(o(),v("div",Tt,[i(g,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),l[11]||(l[11]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):V("",!0),D.value&&t.reservation?(o(),v("div",Ut,[i(g,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),l[12]||(l[12]=e("span",{class:"warning-banner__text"},[$(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),$(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):V("",!0)]),_:1}),i(ue,{class:"pt-4 px-6 pb-6"},{default:P(()=>[i(ge),i(G,{color:"text",variant:"text",onClick:l[3]||(l[3]=r=>k.value=!1)},{default:P(()=>[i(g,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),l[13]||(l[13]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),i(G,{class:"px-3",color:"error",variant:"flat",onClick:p},{default:P(()=>[i(g,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),l[14]||(l[14]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Lt=J(Bt,[["__scopeId","data-v-f3f81b6e"]]),It={key:0,class:"reservation-list__header"},Ht={class:"reservation-list__title"},Ft={class:"reservation-list__title-text"},zt={key:1,class:"reservation-list__title-count"},Gt={class:"reservation-list__actions"},Ot={class:"reservation-list__empty-content"},Nt=["innerHTML"],At=["innerHTML"],jt={class:"reservation-list__grid-content"},qt={key:1,class:"reservation-list__pagination"},Jt=j({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(t,{emit:C}){const c=t,x=w(c.page),f=w(c.sortOrder),a=w([...c.reservations]),u=w(c.total),s=w(!1),h=w(null);R(()=>c.page,_=>{x.value=_}),R(()=>c.sortOrder,_=>{f.value=_}),R(()=>c.reservations,_=>{a.value=[..._]}),R(()=>c.total,_=>{u.value=_});const k=C,D=_=>{h.value=_,s.value=!0},M=_=>{a.value=a.value.filter(n=>n.id!==_),u.value=Math.max(0,u.value-1),s.value=!1,k("delete",_)},E=_=>{const n=a.value.findIndex(y=>y.id===_.id);n!==-1&&(a.value[n]=_),h.value=_};return(_,n)=>{const y=q("Icon");return o(),v("div",{class:T(["reservation-list",{"reservation-list--show-sort":!t.hideSort}])},[t.hideHeader?V("",!0):(o(),v("div",It,[e("h2",Ht,[t.showBackButton?O((o(),v("div",{key:0,class:"reservation-list__title-back",onClick:n[0]||(n[0]=p=>_.$router.back())},[i(y,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[N]]):V("",!0),e("span",Ft,m(t.title),1),t.showMoreButton?V("",!0):(o(),v("div",zt,[t.isLoading?(o(),z(y,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(o(),v(A,{key:1},[$(m(u.value)+"件",1)],64))]))]),e("div",Gt,[t.hideSort?V("",!0):(o(),z(Z,{key:0,modelValue:f.value,"onUpdate:modelValue":[n[1]||(n[1]=p=>f.value=p),n[2]||(n[2]=p=>_.$emit("update:sortOrder",p))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),t.showMoreButton?(o(),z(G,{key:1,variant:"text",class:"reservation-list__more",onClick:n[3]||(n[3]=p=>_.$emit("more"))},{default:P(()=>[n[7]||(n[7]=e("span",{class:"text-primary"},"もっと見る",-1)),i(y,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):V("",!0)])])),e("div",{class:T(["reservation-list__grid",{"reservation-list__grid--loading":t.isLoading,"reservation-list__grid--empty":u.value===0&&t.showEmptyMessage}])},[e("div",{class:T(["reservation-list__empty",{"reservation-list__empty--show":u.value===0&&t.showEmptyMessage&&!t.isLoading}])},[e("div",Ot,[i(y,{class:"reservation-list__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:t.emptyMessage},null,8,Nt),t.emptySubMessage?(o(),v("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:t.emptySubMessage},null,8,At)):V("",!0)])],2),e("div",jt,[(o(!0),v(A,null,W(a.value,p=>(o(),z(Fe,{key:p.id,reservation:p,onDeleted:M,onClick:D},null,8,["reservation"]))),128))])],2),!t.hidePagination&&u.value>0?(o(),v("div",qt,[i(_e,{modelValue:x.value,"onUpdate:modelValue":[n[4]||(n[4]=p=>x.value=p),n[5]||(n[5]=p=>_.$emit("update:page",p))],"active-color":"primary",density:"comfortable",length:Math.ceil(u.value/30),"total-visible":S(L).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):V("",!0),i(Lt,{modelValue:s.value,"onUpdate:modelValue":n[6]||(n[6]=p=>s.value=p),reservation:h.value,onDeleted:M,onUpdated:E},null,8,["modelValue","reservation"])],2)}}}),or=J(Jt,[["__scopeId","data-v-0e683281"]]);export{or as R};
