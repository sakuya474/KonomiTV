import{B as H}from"./Breadcrumbs-DEnFt1qR.js";import{H as $,N as k}from"./Navigation-CyhYZZ4V.js";import{S as A}from"./SPHeaderBar-gFvA6uHA.js";import{R as y}from"./RecordedProgramList-CYI5kOb4.js";import{d as N,Z as a,u as U,B as P,z as F,am as T,ah as z,c as O,a as r,b as f,n as W,an as j,M as _,o as Z,_ as q}from"./index-COHnkh6W.js";import{V as w}from"./Videos-poOv0AxI.js";import"./VSpacer-vvZXOq7o.js";import"./ssrBoot-DOi1QZ1r.js";import"./VDialog-CCzyQcvZ.js";import"./VOverlay-2ml7HyEQ.js";import"./forwardRefs-DboJVnh3.js";import"./dialog-transition-BnJY0NeI.js";import"./VCard-CmCAOsNx.js";import"./VRow-BUBazC-c.js";import"./VSelect-DkNZdGh4.js";import"./VTextField-DGZZU_3D.js";import"./VDivider-D2zF8kNc.js";import"./VSelectionControl-D7U128Lu.js";import"./VCheckbox-BZzWLu7f.js";import"./VTooltip-BSDnXtNa.js";import"./VPagination-DgmADAVg.js";const x={class:"route-container"},D={class:"videos-home-container-wrapper"},G={class:"videos-home-container"},J=30*1e3,K=N({__name:"Home",setup(Q){const l=a([]),M=a(0),c=a([]),d=a(0),m=a([]),u=a(0),o=a(!0),n=a(null),b=a(),i=U();P(()=>i.settings.mylist,async()=>{await p()},{deep:!0}),P(()=>i.settings.watched_history,async()=>{await g()},{deep:!0});const S=async()=>{await E(),await p(),await g()},E=async()=>{const e=await w.fetchVideos("desc",1);e&&(l.value=e.recorded_programs.slice(0,10),M.value=e.total)},p=async()=>{const e=i.settings.mylist.filter(s=>s.type==="RecordedProgram").sort((s,v)=>v.created_at-s.created_at).map(s=>s.id);if(e.length===0){c.value=[],d.value=0;return}const t=await w.fetchVideos("ids",1,e);t&&(c.value=t.recorded_programs.slice(0,4),d.value=t.total)},g=async()=>{const e=i.settings.watched_history.sort((s,v)=>v.updated_at-s.updated_at).map(s=>s.video_id);if(e.length===0){m.value=[],u.value=0;return}const t=await w.fetchVideos("ids",1,e);t&&(m.value=t.recorded_programs.slice(0,4),u.value=t.total)},R={recentPrograms:E,mylistPrograms:p,watchedPrograms:g},h=async()=>{try{await Promise.all(Object.values(R).map(e=>e())),o.value=!1}catch(e){console.error("Failed to update sections:",e),o.value=!1}},B=()=>{n.value===null&&(h(),n.value=window.setInterval(h,J))},I=()=>{n.value!==null&&(clearInterval(n.value),n.value=null)};F(async()=>{await T().fetchUser(),B(),window.addEventListener("tsreplace-encoding-completed",S)}),z(()=>{I(),window.removeEventListener("tsreplace-encoding-completed",S)});const L=e=>{_.success("エンコードが完了しました。録画一覧を更新します。"),h()},V=(e,t)=>{_.error(`エンコードが失敗しました: ${t}`)},C=e=>{_.info("エンコードがキャンセルされました。")};return(e,t)=>(Z(),O("div",x,[r($),f("main",null,[r(k),f("div",D,[r(A),f("div",G,[r(H,{crumbs:[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/",disabled:!0}]}),r(y,{class:W(["videos-home-container__recent-programs",{"videos-home-container__recent-programs--loading":l.value.length===0&&o.value}]),title:"新着の録画番組",programs:l.value,total:M.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showSearch:!0,isLoading:o.value,showEmptyMessage:!o.value,onMore:t[0]||(t[0]=s=>e.$router.push("/videos/programs"))},null,8,["class","programs","total","isLoading","showEmptyMessage"]),r(y,{title:"マイリスト",programs:c.value,total:d.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"ic:round-playlist-play",emptyMessage:"あとで見たい番組を<br class='d-sm-none'>マイリストに保存できます。",emptySubMessage:"録画番組の右上にある ＋ ボタンから、<br class='d-sm-none'>番組をマイリストに追加できます。",isLoading:o.value,forMylist:!0,onMore:t[1]||(t[1]=s=>e.$router.push("/mylist/"))},null,8,["programs","total","showEmptyMessage","isLoading"]),r(y,{title:"視聴履歴",programs:m.value,total:u.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"fluent:history-20-regular",emptyMessage:"まだ視聴履歴がありません。",emptySubMessage:"録画番組を30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",isLoading:o.value,forWatchedHistory:!0,onMore:t[2]||(t[2]=s=>e.$router.push("/watched-history/"))},null,8,["programs","total","showEmptyMessage","isLoading"])])])]),r(j,{ref_key:"encodingProgress",ref:b,onCompleted:L,onFailed:V,onCancelled:C},null,512)]))}}),_e=q(K,[["__scopeId","data-v-bfbcc59b"]]);export{_e as default};
