import{d as $,al as ee,ai as se,q as s,X as C,z as W,c as v,e as i,n as q,b as a,a as t,r as ae,t as d,am as X,k,V as _,p as I,h as l,w as te,v as re,l as E,an as oe,M as le,o,_ as ne}from"./index-CDWVcQhX.js";import{V as ce}from"./index-CLhJ9qLc.js";import{V as j}from"./VChip-dbO7df1s.js";import{V as ie}from"./RecordedProgramList-BOUpGKQ0.js";const ue={class:"encoding-progress__compact-info"},de={class:"ml-2"},pe={key:0,class:"encoding-progress__compact-progress"},ge={class:"encoding-progress__compact-percentage"},ve={class:"encoding-progress__compact-actions"},_e={class:"encoding-progress__expanded-content"},me={class:"encoding-progress__header"},he={class:"encoding-progress__title"},fe={class:"ml-2"},ke={class:"encoding-progress__actions"},xe={class:"encoding-progress__content"},ye={key:0,class:"encoding-progress__program-info"},we={class:"encoding-progress__program-title"},Ce={class:"encoding-progress__details"},Ie={class:"encoding-progress__codec-info"},Te={key:1,class:"encoding-progress__progress-bar"},Ve={class:"encoding-progress__progress-text"},ze={key:0},Se={key:1},qe={key:2,class:"encoding-progress__error"},Ee=$({__name:"TSReplaceEncodingProgress",props:{taskId:{},autoHide:{type:Boolean,default:!0}},emits:["completed","failed","cancelled","hidden"],setup(G,{expose:J,emit:K}){const r=G,x=K,T=ee(),y=se(),p=s(()=>r.taskId?T.getTask(r.taskId):null);T.initializeWebSocket();const V=C(!1),h=C(!1),n=C(!1),B=C(!0),M=()=>{n.value=!n.value,B.value=!1},c=s(()=>{var e;return((e=p.value)==null?void 0:e.status)??"queued"}),f=s(()=>{var e;return((e=p.value)==null?void 0:e.progress)??0}),z=s(()=>{var e;return((e=p.value)==null?void 0:e.errorMessage)??""}),P=s(()=>{var e;return((e=p.value)==null?void 0:e.programTitle)??"読み込み中..."}),O=s(()=>{var e;return(e=p.value)==null?void 0:e.codec}),Q=s(()=>{var e;return(e=p.value)==null?void 0:e.encoderType});s(()=>{var e;return(e=p.value)==null?void 0:e.startedAt});const A=s(()=>["queued","processing"].includes(c.value)),w=s(()=>c.value==="queued"||c.value==="processing"&&f.value===0),S=s(()=>y.user!==null&&y.user.is_admin===!0&&["queued","processing"].includes(c.value)&&!h.value),N=s(()=>y.user!==null&&y.user.is_admin===!0&&["completed","failed","cancelled"].includes(c.value)),D=s(()=>{switch(c.value){case"queued":return"エンコード待機中";case"processing":return"エンコード中";case"completed":return"エンコード完了";case"failed":return"エンコード失敗";case"cancelled":return"エンコードキャンセル";default:return"状況不明"}}),H=s(()=>{switch(c.value){case"queued":return"fluent:clock-20-regular";case"processing":return"fluent:arrow-sync-20-regular";case"completed":return"fluent:checkmark-circle-20-regular";case"failed":return"fluent:error-circle-20-regular";case"cancelled":return"fluent:dismiss-circle-20-regular";default:return"fluent:question-circle-20-regular"}}),b=s(()=>{switch(c.value){case"processing":return"encoding-progress__icon--spin";case"completed":return"text-success";case"failed":return"text-error";case"cancelled":return"text-warning";default:return"text-primary"}}),R=s(()=>{switch(c.value){case"completed":return"success";case"failed":return"error";case"cancelled":return"warning";default:return"primary"}}),Y=s(()=>{switch(O.value){case"h264":return"H.264";case"hevc":return"H.265";default:return"-"}}),Z=s(()=>{switch(Q.value){case"software":return"ソフトウェア";case"hardware":return"ハードウェア";default:return"-"}}),U=async()=>{if(!(!r.taskId||!S.value)){h.value=!0;try{const e=await oe.cancelEncoding(r.taskId)}catch(e){console.error("Failed to cancel encoding:",e),le.error("エンコードのキャンセルに失敗しました。")}finally{h.value=!1}}},F=()=>{r.taskId&&(T.removeTask(r.taskId),g())},g=()=>{V.value=!1,x("hidden")},L=()=>{r.taskId&&(V.value=!0)};return W(()=>r.taskId,e=>{e?L():g()},{immediate:!0}),W(c,(e,m)=>{e===m||!r.taskId||(e==="completed"?(x("completed",r.taskId),r.autoHide&&setTimeout(()=>g(),5e3)):e==="failed"?x("failed",r.taskId,z.value||"Unknown error"):e==="cancelled"&&(x("cancelled",r.taskId),r.autoHide&&setTimeout(()=>g(),3e3)))}),J({showProgress:L,hideProgress:g}),(e,m)=>{const u=ae("Icon");return V.value?(o(),v("div",{key:0,class:q(["encoding-progress",{"encoding-progress--collapsed":n.value,"encoding-progress--expanded":!n.value,"encoding-progress--initial-show":B.value}])},[a("div",{class:"encoding-progress__compact-header",onClick:M},[a("div",ue,[t(u,{icon:H.value,class:q(b.value),width:"16px",height:"16px"},null,8,["icon","class"]),a("span",de,d(D.value),1),A.value&&n.value?(o(),v("div",pe,[t(X,{"model-value":f.value,color:R.value,height:"4",rounded:"",indeterminate:w.value},null,8,["model-value","color","indeterminate"]),a("span",ge,d(w.value?"...":Math.round(f.value)+"%"),1)])):i("",!0)]),a("div",ve,[t(_,{size:"x-small",variant:"text",onClick:I(M,["stop"]),class:"mr-1"},{default:l(()=>[t(u,{icon:n.value?"fluent:chevron-down-20-regular":"fluent:chevron-up-20-regular",width:"16px",height:"16px"},null,8,["icon"])]),_:1}),S.value&&n.value?(o(),k(_,{key:0,size:"x-small",variant:"flat",color:"error",onClick:I(U,["stop"]),loading:h.value},{default:l(()=>[t(u,{icon:"fluent:stop-20-regular",width:"14px",height:"14px"})]),_:1},8,["loading"])):i("",!0),N.value&&n.value?(o(),k(_,{key:1,size:"x-small",variant:"flat",color:"grey",onClick:I(F,["stop"])},{default:l(()=>[t(u,{icon:"fluent:delete-20-regular",width:"14px",height:"14px"})]),_:1})):i("",!0),n.value?(o(),k(_,{key:2,size:"x-small",variant:"flat",color:"grey",onClick:I(g,["stop"])},{default:l(()=>[t(u,{icon:"fluent:dismiss-20-regular",width:"14px",height:"14px"})]),_:1})):i("",!0)])]),t(ce,null,{default:l(()=>[te(a("div",_e,[a("div",me,[a("div",he,[t(u,{icon:H.value,class:q(b.value),width:"20px",height:"20px"},null,8,["icon","class"]),a("span",fe,d(D.value),1)]),a("div",ke,[S.value?(o(),k(_,{key:0,size:"small",variant:"flat",color:"error",onClick:U,loading:h.value},{default:l(()=>[t(u,{icon:"fluent:stop-20-regular",width:"16px",height:"16px"}),m[0]||(m[0]=a("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["loading"])):i("",!0),N.value?(o(),k(_,{key:1,size:"small",variant:"flat",color:"grey",onClick:F},{default:l(()=>[t(u,{icon:"fluent:delete-20-regular",width:"16px",height:"16px"}),m[1]||(m[1]=a("span",{class:"ml-1"},"削除",-1))]),_:1})):i("",!0),t(_,{size:"small",variant:"flat",color:"grey",onClick:g},{default:l(()=>[t(u,{icon:"fluent:dismiss-20-regular",width:"16px",height:"16px"})]),_:1})])]),a("div",xe,[P.value?(o(),v("div",ye,[a("span",we,d(P.value),1)])):i("",!0),a("div",Ce,[a("div",Ie,[t(j,{size:"small",color:"primary",variant:"tonal"},{default:l(()=>[E(d(Y.value),1)]),_:1}),t(j,{size:"small",color:"secondary",variant:"tonal",class:"ml-2"},{default:l(()=>[E(d(Z.value),1)]),_:1})])]),A.value?(o(),v("div",Te,[t(X,{"model-value":f.value,color:R.value,height:"8",rounded:"",indeterminate:w.value},null,8,["model-value","color","indeterminate"]),a("div",Ve,[w.value?(o(),v("span",Se,"処理中...")):(o(),v("span",ze,d(Math.round(f.value))+"%",1))])])):i("",!0),z.value?(o(),v("div",qe,[t(ie,{type:"error",variant:"tonal",density:"compact"},{default:l(()=>[E(d(z.value),1)]),_:1})])):i("",!0)])],512),[[re,!n.value]])]),_:1})],2)):i("",!0)}}}),Ne=ne(Ee,[["__scopeId","data-v-1e62eda6"]]);export{Ne as T};
