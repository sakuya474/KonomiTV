import{a as C,S as H}from"./swiper-D2xX2d47.js";import{d as I,u as E,Z as s,B as b,z as U,am as V,ao as N,c as O,a as o,b as r,f as P,n as L,h as f,ai as l,ap as R,o as T,_ as W}from"./index-CXDo8RiN.js";import{B as z}from"./Breadcrumbs-8XQGS1Y1.js";import{H as $,N as Z}from"./Navigation-QrN98pcO.js";import{B as j}from"./BDLibraryList-6EBWWvxK.js";import{R as A}from"./RecordedProgramList-B1buqtOm.js";import{V as F}from"./Videos-COoJyyjW.js";import{u as G}from"./BDLibraryHistoryStore-DOxgNuPy.js";import"./VSpacer-Bm2Tn-jk.js";import"./ssrBoot-Dtvu6cBu.js";import"./BDLibrary-DlRB3faQ.js";import"./BDLibraryMylistStore-z_FFTxw9.js";import"./VSelect--6IAWogw.js";import"./VTextField-x2BS6cSj.js";import"./forwardRefs-DboJVnh3.js";import"./dialog-transition-D4Y-KFTV.js";import"./VOverlay-B2e8aeb0.js";import"./VDivider-DY8gZwUt.js";import"./VSelectionControl-bbTZhefg.js";import"./VCard-BM0nYf_3.js";import"./VDialog-r2MYbwYx.js";import"./VPagination-THEAsM_R.js";import"./VRow-CZejbScS.js";import"./VCheckbox-CzvQPuZ6.js";import"./VTooltip-CWsCtJMb.js";const J={class:"route-container"},K={class:"watched-history-container-wrapper"},X={class:"watched-history-container"},Y={class:"tab-container"},Q=I({__name:"WatchedHistory",setup(tt){const n=N(),w=R(),B=E(),c=G(),i=s("videos"),p=s(null),m=s([]),v=s(0),d=s(!0),u=s(1),g=async()=>{const e=B.settings.watched_history.sort((a,x)=>x.updated_at-a.updated_at).map(a=>a.video_id);if(e.length===0){m.value=[],v.value=0,d.value=!1;return}const t=await F.fetchVideos("ids",u.value,e);t&&(m.value=t.recorded_programs,v.value=t.total),d.value=!1},h=s([]),S=s(0),y=s(1),_=s("added_desc"),D=async()=>{await c.fetchHistoryList();let e=c.history_items.map(t=>({id:t.id,bd_id:t.bd_id,title:t.title,path:t.path,watched_at:t.watched_at,position:t.position,duration:t.duration}));switch(_.value){case"added_asc":e.sort((t,a)=>new Date(t.watched_at||0).getTime()-new Date(a.watched_at||0).getTime());break;case"added_desc":default:e.sort((t,a)=>new Date(a.watched_at||0).getTime()-new Date(t.watched_at||0).getTime());break}h.value=e,S.value=h.value.length},M=async e=>{y.value=e},k=async e=>{_.value=e,y.value=1,await D()},q=async e=>{u.value=e,d.value=!0,await w.replace({query:{...n.query,page:e.toString()}})};return b(()=>n.query,async e=>{e.page&&(u.value=parseInt(e.page)),await g()},{deep:!0}),b(()=>B.settings.watched_history,async()=>{await g()},{deep:!0}),U(async()=>{await V().fetchUser(),n.query.page&&(u.value=parseInt(n.query.page)),await g()}),b(i,async e=>{p.value&&p.value.slideTo(e==="videos"?0:1),e==="bd"&&await D(),await w.replace({query:{...n.query,tab:e}})}),(e,t)=>(T(),O("div",J,[o($),r("main",null,[o(Z),r("div",K,[r("div",X,[o(z,{crumbs:[{name:"ホーム",path:"/"},{name:"視聴履歴",path:"/watched-history/",disabled:!0}]}),r("div",Y,[r("div",{class:"tab-buttons",style:P({"--tab-length":2,"--active-tab-index":i.value==="videos"?0:1})},[r("button",{class:L(["tab-button",{active:i.value==="videos"}]),onClick:t[0]||(t[0]=a=>i.value="videos")}," 録画番組 ",2),r("button",{class:L(["tab-button",{active:i.value==="bd"}]),onClick:t[1]||(t[1]=a=>i.value="bd")}," BD ",2),t[4]||(t[4]=r("div",{class:"tab-highlight"},null,-1))],4)]),o(l(C),{class:"content-swiper","space-between":32,"auto-height":!0,"touch-start-prevent-default":!1,observer:!0,"observe-parents":!0,"initial-slide":0,onSwiper:t[2]||(t[2]=a=>p.value=a),onSlideChange:t[3]||(t[3]=a=>i.value=a.activeIndex===0?"videos":"bd")},{default:f(()=>[o(l(H),null,{default:f(()=>[o(A,{title:"視聴履歴",programs:m.value,total:v.value,page:u.value,hideSort:!0,isLoading:d.value,showBackButton:!0,showEmptyMessage:!d.value,emptyIcon:"fluent:history-20-regular",emptyMessage:"まだ視聴履歴がありません。",emptySubMessage:"録画番組を30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",forWatchedHistory:!0,"onUpdate:page":q},null,8,["programs","total","page","isLoading","showEmptyMessage"])]),_:1}),o(l(H),null,{default:f(()=>[o(j,{title:"BD視聴履歴",items:h.value,total:S.value,page:y.value,sortOrder:_.value,isLoading:l(c).is_loading,showBackButton:!0,showEmptyMessage:!l(c).is_loading,emptyIcon:"fluent:history-20-regular",emptyMessage:"まだBDの視聴履歴がありません。",emptySubMessage:"BDを30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",forWatchedHistory:!0,"onUpdate:page":M,"onUpdate:sortOrder":k},null,8,["items","total","page","sortOrder","isLoading","showEmptyMessage"])]),_:1})]),_:1})])])])]))}}),Lt=W(Q,[["__scopeId","data-v-6b6cb7ab"]]);export{Lt as default};
