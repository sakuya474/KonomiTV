import{d as X,k as b,h as r,a,b as e,w as R,r as Y,c as m,e as _,t as n,ai as H,U as D,P as W,aq as be,F as A,o as l,R as q,_ as ee,x as U,Z as B,B as N,z as we,l as u,aB as ce,aC as ge,al as J,ab as _e,aD as se,V as Q,aE as xe,aF as ke,M,aG as ve,u as $e,n as j,f as pe,p as O,j as Ve,am as Me,g as Ce,ap as He}from"./index-CXDo8RiN.js";import{V as de}from"./VDialog-r2MYbwYx.js";import{d as ne,V as ue,b as he,c as ye}from"./VCard-BM0nYf_3.js";import{V as me}from"./VSpacer-Bm2Tn-jk.js";import{V as ie,a as Z}from"./VRow-CZejbScS.js";import{c as K,V as T,b as Be,a as I,d as Se}from"./VSelect--6IAWogw.js";import{V as Te}from"./VCheckbox-CzvQPuZ6.js";import{V as Pe}from"./VTooltip-CWsCtJMb.js";import{V as le}from"./Videos-COoJyyjW.js";import{V as fe}from"./VDivider-DY8gZwUt.js";import{V as Re}from"./VPagination-THEAsM_R.js";const ze={class:"px-5 pb-6"},Ee={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-2"},Ie={class:"video-info__item"},De={class:"video-info__item-value"},Le={class:"video-info__item"},Ue={class:"video-info__item-value"},Ae={class:"video-info__item"},Fe={class:"video-info__item-value"},Oe={class:"video-info__item"},We={class:"video-info__item-value"},qe={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},je={class:"video-info__item"},Ge={class:"video-info__item-value"},Ne={class:"video-info__item"},Ye={class:"video-info__item-value"},Qe={class:"video-info__item"},Ze={class:"video-info__item-value"},Je={class:"video-info__item"},Ke={class:"video-info__item-value"},Xe={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},et={class:"video-info__item"},tt={class:"video-info__item-value"},ot={class:"video-info__item"},at={class:"video-info__item-value"},rt={class:"video-info__item"},st={class:"video-info__item-value"},it={key:0,class:"text-subtitle-1 d-flex align-center font-weight-bold mt-3"},lt={class:"video-info__item"},dt={class:"video-info__item-value"},nt={class:"video-info__item"},ut={class:"video-info__item-value"},mt={class:"video-info__item"},ct={class:"video-info__item-value"},gt=X({__name:"RecordedFileInfoDialog",props:{program:{},show:{type:Boolean}},emits:["update:show"],setup(o){return(x,s)=>{const w=Y("Icon");return l(),b(de,{"max-width":"770",transition:"slide-y-transition","model-value":o.show,"onUpdate:modelValue":s[1]||(s[1]=k=>x.$emit("update:show",k))},{default:r(()=>[a(ne,{class:"video-info"},{default:r(()=>[a(ue,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:r(()=>[a(w,{icon:"fluent:document-20-filled",height:"26px"}),s[2]||(s[2]=e("span",{class:"ml-3"},"録画ファイル情報",-1)),a(me),R((l(),m("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:s[0]||(s[0]=k=>x.$emit("update:show",!1))},[a(w,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[q]])]),_:1}),e("div",ze,[e("div",Ee,[a(w,{icon:"fluent:video-clip-20-filled",width:"24px",height:"20px"}),s[3]||(s[3]=e("span",{class:"ml-2"},"ファイル情報",-1))]),e("div",Ie,[s[4]||(s[4]=e("div",{class:"video-info__item-label"},"ファイルパス",-1)),e("div",De,n(o.program.recorded_video.file_path),1)]),e("div",Le,[s[5]||(s[5]=e("div",{class:"video-info__item-label"},"ファイルサイズ",-1)),e("div",Ue,n(H(D).formatBytes(o.program.recorded_video.file_size)),1)]),e("div",Ae,[s[6]||(s[6]=e("div",{class:"video-info__item-label"},"録画期間",-1)),e("div",Fe,n(H(W).getRecordingTime(o.program)),1)]),e("div",Oe,[s[7]||(s[7]=e("div",{class:"video-info__item-label"},"最終更新日時",-1)),e("div",We,n(H(D).apply28HourClock(H(be)(o.program.recorded_video.file_modified_at).format("YYYY/MM/DD (dd) HH:mm:ss"))),1)]),e("div",qe,[a(w,{icon:"fluent:video-20-filled",width:"24px",height:"20px"}),s[8]||(s[8]=e("span",{class:"ml-2"},"映像情報",-1))]),e("div",je,[s[9]||(s[9]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",Ge,n(o.program.recorded_video.video_codec)+" ("+n(o.program.recorded_video.video_codec_profile)+")",1)]),e("div",Ne,[s[10]||(s[10]=e("div",{class:"video-info__item-label"},"解像度",-1)),e("div",Ye,n(o.program.recorded_video.video_resolution_width)+"×"+n(o.program.recorded_video.video_resolution_height),1)]),e("div",Qe,[s[11]||(s[11]=e("div",{class:"video-info__item-label"},"フレームレート",-1)),e("div",Ze,n(o.program.recorded_video.video_frame_rate)+" fps",1)]),e("div",Je,[s[12]||(s[12]=e("div",{class:"video-info__item-label"},"スキャン方式",-1)),e("div",Ke,n(o.program.recorded_video.video_scan_type),1)]),e("div",Xe,[a(w,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[13]||(s[13]=e("span",{class:"ml-2"},"音声情報（主音声）",-1))]),e("div",et,[s[14]||(s[14]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",tt,n(o.program.recorded_video.primary_audio_codec),1)]),e("div",ot,[s[15]||(s[15]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",at,n(o.program.recorded_video.primary_audio_channel),1)]),e("div",rt,[s[16]||(s[16]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",st,n(o.program.recorded_video.primary_audio_sampling_rate?`${o.program.recorded_video.primary_audio_sampling_rate/1e3}kHz`:"不明"),1)]),o.program.recorded_video.secondary_audio_codec?(l(),m("div",it,[a(w,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),s[17]||(s[17]=e("span",{class:"ml-2"},"音声情報（副音声）",-1))])):_("",!0),o.program.recorded_video.secondary_audio_codec?(l(),m(A,{key:1},[e("div",lt,[s[18]||(s[18]=e("div",{class:"video-info__item-label"},"コーデック",-1)),e("div",dt,n(o.program.recorded_video.secondary_audio_codec),1)]),e("div",nt,[s[19]||(s[19]=e("div",{class:"video-info__item-label"},"チャンネル",-1)),e("div",ut,n(o.program.recorded_video.secondary_audio_channel),1)]),e("div",mt,[s[20]||(s[20]=e("div",{class:"video-info__item-label"},"サンプリングレート",-1)),e("div",ct,n(o.program.recorded_video.secondary_audio_sampling_rate?`${o.program.recorded_video.secondary_audio_sampling_rate/1e3}kHz`:"不明"),1)])],64)):_("",!0)])]),_:1})]),_:1},8,["model-value"])}}}),vt=ee(gt,[["__scopeId","data-v-fdcb1441"]]),pt={class:"encoding-dialog__program-info mb-4"},ft={class:"encoding-dialog__program-title"},_t={key:0,class:"encoding-dialog__program-meta"},ht={class:"encoding-dialog__program-channel"},yt={class:"encoding-dialog__program-time"},bt={class:"encoding-dialog__settings"},wt={class:"d-flex align-center"},xt={class:"text-caption"},kt={class:"d-flex align-center"},$t={class:"text-caption"},Vt={class:"d-flex align-center"},Mt={class:"text-caption"},Ct={class:"d-flex align-center"},Ht=X({__name:"TSReplaceEncodingDialog",props:{show:{type:Boolean,default:!1},program:{}},emits:["update:show","encoding-started"],setup(o,{emit:x}){const s=o,w=x,k=U({get:()=>s.show,set:$=>w("update:show",$)}),c=B(!1),S=B(!1),v=B("h264"),d=B("software"),C=B("medium"),f=B(!1),te=[{value:"h264",label:"H.264 (AVC)",description:"互換性が高く、多くのデバイスで再生可能",recommended:!0},{value:"hevc",label:"H.265 (HEVC)",description:"より高い圧縮効率、ファイルサイズが小さくなる",recommended:!1}],oe=U(()=>[{value:"software",label:"ソフトウェアエンコード",description:"FFmpegを使用、時間がかかる",disabled:!1,fast:!1},{value:"hardware",label:"ハードウェアエンコード",description:S.value?"GPU/専用チップを使用、高速で高品質":"使用できません（対応するGPUが検出されませんでした）",disabled:!S.value,fast:!0}]),ae=[{value:"fast",label:"高速",description:"エンコード時間を優先、品質は標準的",recommended:!1},{value:"medium",label:"標準",description:"バランスの取れた設定",recommended:!0},{value:"slow",label:"高品質",description:"品質を優先、エンコード時間は長くなる",recommended:!1}],G=U(()=>!(c.value||!s.program||s.program.recorded_video.is_tsreplace_encoded||d.value==="hardware"&&!S.value)),P=async()=>{try{const $=await xe.fetchHardwareEncoderStatus();S.value=$.hardware_encoder_available,!$.hardware_encoder_available&&d.value==="hardware"&&(d.value="software")}catch($){console.error("Failed to check hardware encoder availability:",$),S.value=!1,d.value==="hardware"&&(d.value="software")}},re=async()=>{var $,i;if(!(!s.program||!G.value)){c.value=!0;try{const V=await ke.startManualEncoding({video_id:s.program.id,codec:v.value,encoder_type:d.value,quality_preset:C.value,delete_original:f.value});V&&V.success&&V.task_id?(M.success("エンコードを開始しました。"),w("encoding-started",V.task_id,v.value,d.value),c.value=!1,F()):M.error("エンコードの開始に失敗しました。")}catch(V){if(console.error("Failed to start encoding:",V),(i=($=V==null?void 0:V.response)==null?void 0:$.data)!=null&&i.detail){const z=V.response.data.detail;z==="Cannot re-encode already encoded video"?M.error("再エンコード済みの動画は再度エンコードできません。"):M.error(`エンコードの開始に失敗しました: ${z}`)}else M.error("エンコードの開始に失敗しました。")}finally{c.value=!1}}},F=()=>{c.value||(k.value=!1)};return N(()=>s.show,$=>{$&&(P(),v.value="h264",d.value="software",C.value="medium",f.value=!1,c.value=!1)}),we(()=>{P()}),($,i)=>{const V=Y("Icon");return l(),b(de,{modelValue:k.value,"onUpdate:modelValue":i[4]||(i[4]=z=>k.value=z),"max-width":"600",persistent:""},{default:r(()=>[a(ne,null,{default:r(()=>[a(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:r(()=>[...i[5]||(i[5]=[u(" 録画ファイルを再エンコード ",-1)])]),_:1}),a(he,{class:"pt-4 pb-0"},{default:r(()=>{var z,g,t,p;return[e("div",pt,[e("div",ft,n(((z=o.program)==null?void 0:z.title)||"取得中..."),1),o.program?(l(),m("div",_t,[e("span",ht,n(((g=o.program.channel)==null?void 0:g.name)||"チャンネル情報なし"),1),e("span",yt,n(H(W).getProgramTime(o.program)),1)])):_("",!0)]),e("div",bt,[a(ie,null,{default:r(()=>[a(Z,{cols:"12",md:"6"},{default:r(()=>[a(K,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=h=>v.value=h),items:te,"item-title":"label","item-value":"value",label:"エンコードコーデック",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,ce(ge(h)),{title:r(()=>[e("div",wt,[e("span",null,n(y.raw.label),1),y.raw.recommended?(l(),b(J,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:r(()=>[...i[6]||(i[6]=[u(" 推奨 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",xt,n(y.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1}),a(Z,{cols:"12",md:"6"},{default:r(()=>[a(K,{modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=h=>d.value=h),items:oe.value,"item-title":"label","item-value":"value",label:"エンコーダータイプ",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,_e(h,{disabled:y.raw.disabled}),{title:r(()=>[e("div",kt,[e("span",null,n(y.raw.label),1),y.raw.fast?(l(),b(J,{key:0,size:"x-small",color:"success",class:"ml-2"},{default:r(()=>[...i[7]||(i[7]=[u(" 高速 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",$t,n(y.raw.description),1)]),_:2},1040,["disabled"])]),_:1},8,["modelValue","items","disabled"])]),_:1})]),_:1}),a(ie,null,{default:r(()=>[a(Z,{cols:"12"},{default:r(()=>[a(K,{modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=h=>C.value=h),items:ae,"item-title":"label","item-value":"value",label:"エンコード品質",variant:"outlined",density:"comfortable","hide-details":"auto",disabled:c.value},{item:r(({props:h,item:y})=>[a(T,ce(ge(h)),{title:r(()=>[e("div",Vt,[e("span",null,n(y.raw.label),1),y.raw.recommended?(l(),b(J,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:r(()=>[...i[8]||(i[8]=[u(" 推奨 ",-1)])]),_:1})):_("",!0)])]),subtitle:r(()=>[e("span",Mt,n(y.raw.description),1)]),_:2},1040)]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1}),!S.value&&d.value==="hardware"?(l(),b(se,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[9]||(i[9]=[u("ハードウェアエンコーダーが利用できません",-1)])]),default:r(()=>[i[10]||(i[10]=u(" ハードウェアエンコーダーが検出されないか、設定で無効になっています。",-1)),i[11]||(i[11]=e("br",null,null,-1)),i[12]||(i[12]=u(" ソフトウェアエンコードを使用してください。 ",-1))]),_:1})):_("",!0),(t=o.program)!=null&&t.recorded_video.is_tsreplace_encoded?(l(),b(se,{key:1,type:"error",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[13]||(i[13]=[u("再エンコード済みの動画です",-1)])]),default:r(()=>[i[14]||(i[14]=u(" この録画ファイルは既に再エンコード済みです。",-1)),i[15]||(i[15]=e("br",null,null,-1)),i[16]||(i[16]=u(" 再エンコード済みの動画は再度エンコードできません。 ",-1))]),_:1})):((p=o.program)==null?void 0:p.recorded_video.video_codec)!=="MPEG-2"?(l(),b(se,{key:2,type:"info",variant:"tonal",class:"mt-4"},{title:r(()=>[...i[17]||(i[17]=[u("既にエンコード済みのファイルです",-1)])]),default:r(()=>{var h;return[u(" この録画ファイルは既に "+n((h=o.program)==null?void 0:h.recorded_video.video_codec)+" でエンコードされています。",1),i[18]||(i[18]=e("br",null,null,-1)),i[19]||(i[19]=u(" 再エンコードすると画質が劣化する可能性があります。 ",-1))]}),_:1})):_("",!0),a(ie,{class:"mt-4"},{default:r(()=>[a(Z,{cols:"12"},{default:r(()=>[a(Te,{modelValue:f.value,"onUpdate:modelValue":i[3]||(i[3]=h=>f.value=h),disabled:c.value,label:"エンコード完了後に元ファイルを削除する","hide-details":"auto"},{label:r(()=>[e("div",Ct,[i[21]||(i[21]=e("span",null,"エンコード完了後に元ファイルを削除する",-1)),a(Pe,{activator:"parent",location:"top"},{default:r(()=>[...i[20]||(i[20]=[e("span",null,[u("チェックすると、エンコード完了後に元のファイルが自動的に削除されます。"),e("br"),u(" 削除されたファイルは復元できませんので、十分注意してください。")],-1)])]),_:1})])]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})])]}),_:1}),a(ye,{class:"pt-4 px-6 pb-6"},{default:r(()=>[a(me),a(Q,{color:"text",variant:"text",onClick:F,disabled:c.value},{default:r(()=>[a(V,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),i[22]||(i[22]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1},8,["disabled"]),a(Q,{class:"px-3",color:"primary",variant:"flat",onClick:re,disabled:!G.value,loading:c.value},{default:r(()=>[a(V,{icon:"fluent:arrow-sync-20-regular",width:"18px",height:"18px"}),i[23]||(i[23]=e("span",{class:"ml-1"},"エンコード開始",-1))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Bt=ee(Ht,[["__scopeId","data-v-b3c29d59"]]),St={class:"recorded-program__container"},Tt={class:"recorded-program__thumbnail"},Pt=["src"],Rt={class:"recorded-program__thumbnail-duration"},zt={key:0,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--recording"},Et={key:1,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--analyzing"},It={key:2,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--partial"},Dt={key:3,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoding"},Lt={key:4,class:"recorded-program__thumbnail-status recorded-program__thumbnail-status--encoded"},Ut={key:5,class:"recorded-program__thumbnail-progress"},At={key:6,class:"recorded-program__thumbnail-progress recorded-program__thumbnail-progress--encoding"},Ft={class:"recorded-program__content"},Ot=["innerHTML"],Wt={class:"recorded-program__content-meta"},qt={key:0,class:"recorded-program__content-meta-broadcaster"},jt=["src"],Gt={class:"recorded-program__content-meta-broadcaster-name"},Nt={key:1,class:"recorded-program__content-meta-broadcaster"},Yt={key:2,class:"recorded-program__content-meta-encoded"},Qt={class:"recorded-program__content-meta-time"},Zt=["innerHTML"],Jt={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},Kt={key:0,width:"22px",height:"22px",viewBox:"0 0 16 16"},Xt={key:1,width:"22px",height:"22px",viewBox:"0 0 15.2 15.2"},eo={class:"recorded-program__menu"},to={class:"delete-confirmation__file-path mb-4"},oo=X({__name:"RecordedProgram",props:{program:{},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["deleted","encoding-started"],setup(o,{emit:x}){const s=o,w=x,k=B(!1),c=B(!1),S=B(!1),v=ve(),d=U(()=>v.getAllTasks().some(t=>t.programTitle===s.program.title&&["queued","processing"].includes(t.status))),C=U(()=>{const t=v.getAllTasks().find(p=>p.programTitle===s.program.title&&["queued","processing"].includes(p.status));return t?{progress:t.progress,status:t.status,codec:t.codec,encoderType:t.encoderType}:null}),f=(g="original")=>{const t=`${D.api_base_url}/videos/${s.program.id}/download?file_type=${g}`;window.location.href=t},te=()=>{S.value=!0},oe=(g,t,p)=>{ve().addTask(g,s.program.title,t,p),w("encoding-started",g),console.log("Encoding started with task ID:",g)},ae=async()=>{M.success("メタデータの再解析を開始します。完了までしばらくお待ちください。"),await le.reanalyzeVideo(s.program.id)===!0&&M.success("メタデータの再解析が完了しました。")},G=async(g=!1)=>{M.success("サムネイルの再作成を開始しました。完了までしばらくお待ちください。"),await le.regenerateThumbnail(s.program.id,g)===!0&&M.success("サムネイルの再作成が完了しました。")},P=$e(),re=()=>{P.settings.mylist.some(t=>t.type==="RecordedProgram"&&t.id===s.program.id)?(P.settings.mylist=P.settings.mylist.filter(t=>!(t.type==="RecordedProgram"&&t.id===s.program.id)),M.show("マイリストから削除しました。")):(P.settings.mylist.push({type:"RecordedProgram",id:s.program.id,created_at:D.time()}),M.success("マイリストに追加しました。"))},F=U(()=>P.settings.mylist.some(g=>g.type==="RecordedProgram"&&g.id===s.program.id)),$=U(()=>P.settings.watched_history.find(g=>g.video_id===s.program.id)),i=()=>{P.settings.watched_history=P.settings.watched_history.filter(g=>g.video_id!==s.program.id),M.show("視聴履歴から削除しました。")},V=()=>{const g=Me();if(g.user===null||g.user.is_admin===!1){M.warning(`録画ファイルを削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}c.value=!0},z=async()=>{c.value=!1,M.info("録画ファイルの削除を開始します。完了までしばらくお待ちください。"),await le.deleteVideo(s.program.id)===!0&&(M.success("録画ファイルを削除しました。"),w("deleted",s.program.id))};return(g,t)=>{const p=Y("Icon"),h=Y("router-link"),y=Ve("ftooltip");return l(),m(A,null,[R((l(),b(h,{class:j(["recorded-program",{"recorded-program--recording":o.program.recorded_video.status==="Recording","recorded-program--analyzing":!o.program.recorded_video.has_key_frames,"recorded-program--encoding":d.value}]),to:o.program.recorded_video.status==="Recording"||!o.program.recorded_video.has_key_frames||d.value?{path:""}:`/videos/watch/${o.program.id}`},{default:r(()=>{var E;return[e("div",St,[e("div",Tt,[e("img",{class:"recorded-program__thumbnail-image",loading:"lazy",decoding:"async",src:`${H(D).api_base_url}/videos/${o.program.id}/thumbnail`},null,8,Pt),e("div",Rt,n(H(W).getProgramDuration(o.program)),1),o.program.recorded_video.status==="Recording"?(l(),m("div",zt,[...t[14]||(t[14]=[e("div",{class:"recorded-program__thumbnail-status-dot"},null,-1),u(" 録画中 ",-1)])])):o.program.recorded_video.has_key_frames?o.program.is_partially_recorded?(l(),m("div",It," ⚠️ 一部のみ録画 ")):d.value&&C.value?(l(),m("div",Dt,[a(p,{icon:"fluent:arrow-sync-12-regular",width:"15px",height:"15px",class:"recorded-program__thumbnail-status-icon--spin"}),u(" エンコード中 ("+n(Math.round(C.value.progress))+"%) ",1)])):(E=o.program)!=null&&E.recorded_video.is_tsreplace_encoded?(l(),m("div",Lt,[a(p,{icon:"fluent:checkmark-circle-12-regular",width:"15px",height:"15px"}),t[16]||(t[16]=u(" 再エンコード済み ",-1))])):_("",!0):(l(),m("div",Et,[a(p,{icon:"fluent:clock-12-regular",width:"15px",height:"15px"}),t[15]||(t[15]=u(" メタデータ解析中 ",-1))])),$.value&&!d.value?(l(),m("div",Ut,[e("div",{class:"recorded-program__thumbnail-progress-bar",style:pe(`width: ${$.value.last_playback_position/o.program.recorded_video.duration*100}%`)},null,4)])):d.value&&C.value?(l(),m("div",At,[e("div",{class:"recorded-program__thumbnail-progress-bar recorded-program__thumbnail-progress-bar--encoding",style:pe(`width: ${C.value.progress}%`)},null,4)])):_("",!0)]),e("div",Ft,[e("div",{class:"recorded-program__content-title",innerHTML:H(W).decorateProgramInfo(o.program,"title")},null,8,Ot),e("div",Wt,[o.program.channel?(l(),m("div",qt,[e("img",{class:"recorded-program__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${H(D).api_base_url}/channels/${o.program.channel.id}/logo`},null,8,jt),e("span",Gt,"Ch: "+n(o.program.channel.channel_number)+" "+n(o.program.channel.name),1)])):(l(),m("div",Nt,[...t[17]||(t[17]=[e("span",{class:"recorded-program__content-meta-broadcaster-name"},"チャンネル情報なし",-1)])])),o.program.recorded_video.is_tsreplace_encoded?(l(),m("div",Yt,[a(J,{size:"x-small",color:"success",variant:"tonal"},{default:r(()=>[a(p,{icon:"fluent:checkmark-circle-12-regular",width:"12px",height:"12px",class:"mr-1"}),t[18]||(t[18]=u(" 再エンコード済み ",-1))]),_:1})])):_("",!0),e("div",Qt,n(H(W).getProgramTime(o.program)),1)]),e("div",{class:"recorded-program__content-description",innerHTML:H(W).decorateProgramInfo(o.program,"description")},null,8,Zt)]),o.forWatchedHistory?_("",!0):R((l(),m("div",{key:0,class:j(["recorded-program__mylist",{"recorded-program__mylist--highlight":F.value&&!o.forMylist}]),onClick:O(re,["prevent","stop"]),onMousedown:t[0]||(t[0]=O(()=>{},["prevent","stop"]))},[o.forMylist?(l(),m("svg",Jt,[...t[19]||(t[19]=[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"},null,-1)])])):(l(),m(A,{key:1},[F.value?(l(),m("svg",Kt,[...t[20]||(t[20]=[e("path",{fill:"currentColor",d:"M14.046 3.486a.75.75 0 0 1-.032 1.06l-7.93 7.474a.85.85 0 0 1-1.188-.022l-2.68-2.72a.75.75 0 1 1 1.068-1.053l2.234 2.267l7.468-7.038a.75.75 0 0 1 1.06.032"},null,-1)])])):(l(),m("svg",Xt,[...t[21]||(t[21]=[e("path",{fill:"currentColor",d:"M8 2.5a.5.5 0 0 0-1 0V7H2.5a.5.5 0 0 0 0 1H7v4.5a.5.5 0 0 0 1 0V8h4.5a.5.5 0 0 0 0-1H8z"},null,-1)])]))],64))],34)),[[q],[y,F.value?"マイリストから削除する":"マイリストに追加する"]]),o.forWatchedHistory?R((l(),m("div",{key:1,class:"recorded-program__mylist",onClick:O(i,["prevent","stop"]),onMousedown:t[1]||(t[1]=O(()=>{},["prevent","stop"]))},[...t[22]||(t[22]=[e("svg",{width:"22px",height:"22px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0M6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0zM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5"})],-1)])],32)),[[q],[y,"視聴履歴から削除する"]]):_("",!0),e("div",eo,[a(Se,{location:"bottom end","close-on-content-click":!0},{activator:r(({props:L})=>[R((l(),m("div",_e({class:"recorded-program__menu-button"},L,{onClick:t[2]||(t[2]=O(()=>{},["prevent","stop"])),onMousedown:t[3]||(t[3]=O(()=>{},["prevent","stop"]))}),[...t[23]||(t[23]=[e("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)])],16)),[[q]])]),default:r(()=>[a(Be,{density:"compact","bg-color":"background-lighten-1",class:"recorded-program__menu-list"},{default:r(()=>[a(T,{onClick:t[4]||(t[4]=L=>k.value=!0)},{prepend:r(()=>[...t[24]||(t[24]=[e("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[25]||(t[25]=[u("録画ファイル情報を表示",-1)])]),_:1})]),_:1}),o.program.recorded_video.is_tsreplace_encoded?(l(),m(A,{key:0},[a(T,{onClick:t[5]||(t[5]=L=>f("original")),disabled:o.program.recorded_video.status==="Recording"||d.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[u("元ファイルをダウンロード ("+n(H(D).formatBytes(o.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"]),a(T,{onClick:t[6]||(t[6]=L=>f("encoded")),disabled:o.program.recorded_video.status==="Recording"||d.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[26]||(t[26]=[u("エンコード済みファイルをダウンロード",-1)])]),_:1})]),_:1},8,["disabled"])],64)):(l(),b(T,{key:1,onClick:t[7]||(t[7]=L=>f("original")),disabled:o.program.recorded_video.status==="Recording"||d.value},{prepend:r(()=>[a(p,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[u("録画ファイルをダウンロード ("+n(H(D).formatBytes(o.program.recorded_video.file_size))+")",1)]),_:1})]),_:1},8,["disabled"])),R((l(),b(T,{onClick:ae},{prepend:r(()=>[a(p,{icon:"fluent:book-arrow-clockwise-20-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[27]||(t[27]=[u("メタデータを再解析",-1)])]),_:1})]),_:1})),[[y,"再生時に必要な録画ファイル情報や番組情報などを解析し直します"]]),R((l(),b(T,{onClick:t[8]||(t[8]=L=>G(!0))},{prepend:r(()=>[a(p,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[28]||(t[28]=[u("サムネイルを更新",-1)])]),_:1})]),_:1})),[[y,"既存のシークバー用サムネイルから代表サムネイルを選び直します 変更反映にはブラウザキャッシュの削除が必要です"]]),R((l(),b(T,{onClick:t[9]||(t[9]=L=>G(!1))},{prepend:r(()=>[a(p,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[29]||(t[29]=[u("サムネイルを再作成",-1)])]),_:1})]),_:1})),[[y,"サムネイルを完全に作り直します（数分かかります） 変更反映にはブラウザキャッシュの削除が必要です"]]),a(fe),R((l(),b(T,{onClick:te,disabled:o.program.recorded_video.status==="Recording"||d.value||o.program.recorded_video.is_tsreplace_encoded},{prepend:r(()=>[a(p,{icon:"fluent:arrow-sync-20-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[30]||(t[30]=[u("録画ファイルを再エンコード",-1)])]),_:1})]),_:1},8,["disabled"])),[[y,o.program.recorded_video.is_tsreplace_encoded?"再エンコード済みの動画は再度エンコードできません":"録画ファイルをH.264またはHEVCに再エンコードします"]]),a(fe),a(T,{onClick:V,disabled:o.program.recorded_video.status==="Recording"||d.value,class:"recorded-program__menu-list-item--danger"},{prepend:r(()=>[a(p,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:r(()=>[a(I,{class:"ml-3"},{default:r(()=>[...t[31]||(t[31]=[u("録画ファイルを削除",-1)])]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})])])]}),_:1},8,["to","class"])),[[q]]),a(vt,{program:o.program,show:k.value,"onUpdate:show":t[10]||(t[10]=E=>k.value=E)},null,8,["program","show"]),a(de,{"max-width":"750",modelValue:c.value,"onUpdate:modelValue":t[12]||(t[12]=E=>c.value=E)},{default:r(()=>[a(ne,null,{default:r(()=>[a(ue,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:r(()=>[...t[32]||(t[32]=[u("本当に録画ファイルを削除しますか？",-1)])]),_:1}),a(he,{class:"pt-2 pb-0"},{default:r(()=>[e("div",to,n(o.program.recorded_video.file_path),1),t[33]||(t[33]=e("div",{class:"text-error-lighten-1 font-weight-bold"},[u(" この録画ファイルに関連するすべてのデータ (サムネイル / .ts.program.txt / .ts.err を含む) が削除されます。"),e("br"),u(" 元に戻すことはできません。本当に録画ファイルを削除しますか？ ")],-1))]),_:1}),a(ye,{class:"pt-4 px-6 pb-6"},{default:r(()=>[a(me),a(Q,{color:"text",variant:"text",onClick:t[11]||(t[11]=E=>c.value=!1)},{default:r(()=>[a(p,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),t[34]||(t[34]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),a(Q,{class:"px-3",color:"error",variant:"flat",onClick:z},{default:r(()=>[a(p,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),t[35]||(t[35]=e("span",{class:"ml-1"},"録画ファイルを削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Bt,{show:S.value,"onUpdate:show":t[13]||(t[13]=E=>S.value=E),program:o.program,onEncodingStarted:oe},null,8,["show","program"])],64)}}}),ao=ee(oo,[["__scopeId","data-v-7889d868"]]),ro={key:0,class:"recorded-program-list__header"},so={class:"recorded-program-list__title"},io={class:"recorded-program-list__title-text"},lo={key:1,class:"recorded-program-list__title-count"},no={class:"recorded-program-list__empty-content"},uo=["innerHTML"],mo=["innerHTML"],co={class:"recorded-program-list__grid-content"},go={key:1,class:"recorded-program-list__pagination"},vo=X({__name:"RecordedProgramList",props:{title:{},programs:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1},isSearching:{type:Boolean,default:!1},forMylist:{type:Boolean,default:!1},forWatchedHistory:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more"],setup(o){He();const x=o,s=B(x.page),w=B(x.sortOrder),k=B([...x.programs]),c=B(x.total);N(()=>x.page,v=>{s.value=v}),N(()=>x.sortOrder,v=>{w.value=v}),N(()=>x.programs,v=>{k.value=[...v]}),N(()=>x.total,v=>{c.value=v});const S=v=>{k.value=k.value.filter(d=>d.id!==v),c.value--};return(v,d)=>{const C=Y("Icon");return l(),m("div",{class:j(["recorded-program-list",{"recorded-program-list--show-sort":!o.hideSort}])},[o.hideHeader?_("",!0):(l(),m("div",ro,[e("h2",so,[o.showBackButton?R((l(),m("div",{key:0,class:"recorded-program-list__title-back",onClick:d[0]||(d[0]=f=>v.$router.back())},[a(C,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[q]]):_("",!0),e("span",io,n(o.title),1),o.showMoreButton?_("",!0):(l(),m("div",lo,[o.isSearching?(l(),m(A,{key:0},[a(C,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),d[6]||(d[6]=e("span",null,"検索中...",-1))],64)):(l(),m(A,{key:1},[u(n(c.value)+"件",1)],64))]))]),e("div",{class:j(["recorded-program-list__actions",{"recorded-program-list__actions--mylist":o.forMylist}])},[o.hideSort?_("",!0):(l(),b(K,{key:0,modelValue:w.value,"onUpdate:modelValue":[d[1]||(d[1]=f=>w.value=f),d[2]||(d[2]=f=>v.$emit("update:sortOrder",f))],items:o.forMylist?[{title:"追加が新しい順",value:"mylist_added_desc"},{title:"追加が古い順",value:"mylist_added_asc"},{title:"録画が新しい順",value:"recorded_desc"},{title:"録画が古い順",value:"recorded_asc"}]:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"recorded-program-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue","items"])),o.showMoreButton?(l(),b(Q,{key:1,variant:"text",class:"recorded-program-list__more",onClick:d[3]||(d[3]=f=>v.$emit("more"))},{default:r(()=>[d[7]||(d[7]=e("span",{class:"text-primary"},"もっと見る",-1)),a(C,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):_("",!0)],2)])),e("div",{class:j(["recorded-program-list__grid",{"recorded-program-list__grid--loading":o.isLoading||o.isSearching,"recorded-program-list__grid--empty":c.value===0&&o.showEmptyMessage,"recorded-program-list__grid--searching":o.isSearching}])},[e("div",{class:j(["recorded-program-list__empty",{"recorded-program-list__empty--show":c.value===0&&o.showEmptyMessage&&!o.isSearching}])},[e("div",no,[a(C,{class:"recorded-program-list__empty-icon",icon:o.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:o.emptyMessage},null,8,uo),o.emptySubMessage?(l(),m("div",{key:0,class:"recorded-program-list__empty-submessage",innerHTML:o.emptySubMessage},null,8,mo)):_("",!0)])],2),e("div",co,[(l(!0),m(A,null,Ce(k.value,f=>(l(),b(ao,{key:f.id,program:f,forMylist:o.forMylist,forWatchedHistory:o.forWatchedHistory,onDeleted:S},null,8,["program","forMylist","forWatchedHistory"]))),128))])],2),!o.hidePagination&&c.value>0?(l(),m("div",go,[a(Re,{modelValue:s.value,"onUpdate:modelValue":[d[4]||(d[4]=f=>s.value=f),d[5]||(d[5]=f=>v.$emit("update:page",f))],"active-color":"primary",density:"comfortable",length:Math.ceil(c.value/30),"total-visible":H(D).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):_("",!0)],2)}}}),Mo=ee(vo,[["__scopeId","data-v-f7a7f4da"]]);export{Mo as R};
